function dropdown(){let o=window.matchMedia("(max-width: 767px)"),s=document.querySelector(".gh-head-menu"),i=s?.querySelector(".nav");if(i){let e=document.querySelector(".gh-head-logo"),t=i.innerHTML;o.matches&&i.querySelectorAll("li").forEach(function(e,t){e.style.transitionDelay=.03*(t+1)+"s"});let n=function(){if(!o.matches){for(var e=[];i.offsetWidth+64>s.offsetWidth&&i.lastElementChild;)e.unshift(i.lastElementChild),i.lastElementChild.remove();if(e.length){let t=document.createElement("button"),n=(t.setAttribute("class","nav-more-toggle gh-icon-btn"),t.setAttribute("aria-label","More"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor"><path d="M21.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM13.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM5.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0z"></path></svg>',document.createElement("div"));n.setAttribute("class","gh-dropdown"),10<=e.length?(document.body.classList.add("is-dropdown-mega"),n.style.gridTemplateRows=`repeat(${Math.ceil(e.length/2)}, 1fr)`):document.body.classList.remove("is-dropdown-mega"),e.forEach(function(e){n.appendChild(e)}),t.appendChild(n),i.appendChild(t),document.body.classList.add("is-dropdown-loaded"),window.addEventListener("click",function(e){document.body.classList.contains("is-dropdown-open")?document.body.classList.remove("is-dropdown-open"):t.contains(e.target)&&document.body.classList.add("is-dropdown-open")})}else document.body.classList.add("is-dropdown-loaded")}};imagesLoaded(e,function(){n()}),window.addEventListener("load",function(){e||n()}),window.addEventListener("resize",function(){setTimeout(()=>{i.innerHTML=t,n()},1)})}}function lightbox(e){document.querySelectorAll(e).forEach(function(e){e.addEventListener("click",function(e){var t=e;t.preventDefault();for(var n,o=[],s=0,i=t.target.closest(".kg-card").previousElementSibling;i&&(i.classList.contains("kg-image-card")||i.classList.contains("kg-gallery-card"));){var a=[];i.querySelectorAll("img").forEach(function(e){a.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e}),s+=1}),i=i.previousElementSibling,o=a.concat(o)}t.target.classList.contains("kg-image")?o.push({src:t.target.getAttribute("src"),msrc:t.target.getAttribute("src"),w:t.target.getAttribute("width"),h:t.target.getAttribute("height"),el:t.target}):(n=!1,t.target.closest(".kg-gallery-card").querySelectorAll("img").forEach(function(e){o.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e}),n||e===t.target?n=!0:s+=1}));for(var r=t.target.closest(".kg-card").nextElementSibling;r&&(r.classList.contains("kg-image-card")||r.classList.contains("kg-gallery-card"));)r.querySelectorAll("img").forEach(function(e){o.push({src:e.getAttribute("src"),msrc:e.getAttribute("src"),w:e.getAttribute("width"),h:e.getAttribute("height"),el:e})}),r=r.nextElementSibling;e=document.querySelectorAll(".pswp")[0];new PhotoSwipe(e,PhotoSwipeUI_Default,o,{bgOpacity:.9,closeOnScroll:!0,fullscreenEl:!1,history:!1,index:s,shareEl:!1,zoomEl:!1,getThumbBoundsFn:function(e){var e=o[e].el,t=window.pageYOffset||document.documentElement.scrollTop,e=e.getBoundingClientRect();return{x:e.left,y:e.top+t,w:e.width}}}).init()})})}function pagination(e,r,c=!1){let l=document.querySelector(".gh-feed");if(!l)return;let t=!1,n=l.nextElementSibling||l.parentElement.nextElementSibling||document.querySelector(".gh-foot"),d=document.querySelector(".gh-loadmore"),o=(!document.querySelector("link[rel=next]")&&d&&d.remove(),async function(){var o=document.querySelector("link[rel=next]");if(o)try{var e=await(await fetch(o.href)).text(),s=(new DOMParser).parseFromString(e,"text/html"),i=s.querySelectorAll(".gh-feed:not(.gh-featured):not(.gh-related) > *");let t=document.createDocumentFragment(),n=[];i.forEach(function(e){e=document.importNode(e,!0);c&&(e.style.visibility="hidden"),t.appendChild(e),n.push(e)}),l.appendChild(t),r&&r(n,u);var a=s.querySelector("link[rel=next]");a&&a.href?o.href=a.href:(o.remove(),d&&d.remove())}catch(e){throw o.remove(),d&&d.remove(),e}}),u=async function(){n.getBoundingClientRect().top<=window.innerHeight&&document.querySelector("link[rel=next]")&&await o()};let s=new IntersectionObserver(async function(e){if(!t){if(t=!0,e[0].isIntersecting)if(c)await o();else for(;n.getBoundingClientRect().top<=window.innerHeight&&document.querySelector("link[rel=next]");)await o();t=!1,document.querySelector("link[rel=next]")||s.disconnect()}});e?s.observe(n):d.addEventListener("click",o)}((e,t)=>{"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()})("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){var n;return e&&t&&((n=(n=this._events=this._events||{})[e]=n[e]||[]).includes(t)||n.push(t)),this},t.once=function(e,t){var n;return e&&t&&(this.on(e,t),((n=this._onceEvents=this._onceEvents||{})[e]=n[e]||{})[t]=!0),this},t.off=function(e,t){e=this._events&&this._events[e];return e&&e.length&&-1!=(t=e.indexOf(t))&&e.splice(t,1),this},t.emitEvent=function(e,t){let n=this._events&&this._events[e];if(n&&n.length){n=n.slice(0),t=t||[];var o,s=this._onceEvents&&this._onceEvents[e];for(o of n)s&&s[o]&&(this.off(e,o),delete s[o]),o.apply(this,t)}return this},t.allOff=function(){return delete this._events,delete this._onceEvents,this},e}),((e,t)=>{"object"==typeof module&&module.exports?module.exports=t(e,require("ev-emitter")):e.imagesLoaded=t(e,e.EvEmitter)})("undefined"!=typeof window?window:this,function(t,e){let i=t.jQuery,a=t.console;function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);let o=e,s;(o="string"==typeof e?document.querySelectorAll(e):o)?(this.elements=(s=o,Array.isArray(s)?s:"object"==typeof s&&"number"==typeof s.length?[...s]:[s]),this.options={},"function"==typeof t?n=t:Object.assign(this.options,t),n&&this.on("always",n),this.getImages(),i&&(this.jqDeferred=new i.Deferred),setTimeout(this.check.bind(this))):a.error("Bad element for imagesLoaded "+(o||e))}(r.prototype=Object.create(e.prototype)).getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};let s=[1,9,11],c=(r.prototype.addElementImages=function(e){"IMG"===e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t,n,o=e.nodeType;if(o&&s.includes(o)){for(t of e.querySelectorAll("img"))this.addImage(t);if("string"==typeof this.options.background)for(n of e.querySelectorAll(this.options.background))this.addElementBackgroundImages(n)}},/url\((['"])?(.*?)\1\)/gi);function n(e){this.img=e}function o(e,t){this.url=e,this.element=t,this.img=new Image}return r.prototype.addElementBackgroundImages=function(t){var n=getComputedStyle(t);if(n){let e=c.exec(n.backgroundImage);for(;null!==e;){var o=e&&e[2];o&&this.addBackground(o,t),e=c.exec(n.backgroundImage)}}},r.prototype.addImage=function(e){e=new n(e);this.images.push(e)},r.prototype.addBackground=function(e,t){e=new o(e,t);this.images.push(e)},r.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,this.images.length){let t=(e,t,n)=>{setTimeout(()=>{this.progress(e,t,n)})};this.images.forEach(function(e){e.once("progress",t),e.check()})}else this.complete()},r.prototype.progress=function(e,t,n){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+n,e,t)},r.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred&&(e=this.hasAnyBroken?"reject":"resolve",this.jqDeferred[e](this))},(n.prototype=Object.create(e.prototype)).check=function(){this.getIsImageComplete()?this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src)},n.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},n.prototype.confirm=function(e,t){this.isLoaded=e;e=this.img.parentNode,e="PICTURE"===e.nodeName?e:this.img;this.emitEvent("progress",[this,e,t])},n.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},n.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},n.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},n.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},(o.prototype=Object.create(n.prototype)).check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},o.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},o.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},(r.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((i=e).fn.imagesLoaded=function(e,t){return new r(this,e,t).jqDeferred.promise(i(this))})})(),r}),((e,t)=>{"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipeUI_Default=t()})(this,function(){return function(o,r){function e(e){if(A)return!0;e=e||window.event,S.timeToIdle&&S.mouseUsed&&!v&&a();for(var t,n,o=(e.target||e.srcElement).getAttribute("class")||"",s=0;s<q.length;s++)(t=q[s]).onTap&&-1<o.indexOf("pswp__"+t.name)&&(t.onTap(),n=!0);n&&(e.stopPropagation&&e.stopPropagation(),A=!0,e=r.features.isOldAndroid?600:30,setTimeout(function(){A=!1},e))}function n(){var e=1===S.getNumItemsFn();e!==_&&(P(u,"ui--one-slide",e),_=e)}function t(){P(g,"share-modal--hidden",O)}function s(){for(var e,t,n,o,s="",i=0;i<S.shareButtons.length;i++)e=S.shareButtons[i],t=S.getImageURLForShare(e),n=S.getPageURLForShare(e),o=S.getTextForShare(e),s+='<a href="'+e.url.replace("{{url}}",encodeURIComponent(n)).replace("{{image_url}}",encodeURIComponent(t)).replace("{{raw_image_url}}",t).replace("{{text}}",encodeURIComponent(o))+'" target="_blank" class="pswp__share--'+e.id+'"'+(e.download?"download":"")+">"+e.label+"</a>",S.parseShareButtonOut&&(s=S.parseShareButtonOut(e,s));g.children[0].innerHTML=s,g.children[0].onclick=B}function i(e){for(var t=0;t<S.closeElClasses.length;t++)if(r.hasClass(e,"pswp__"+S.closeElClasses[t]))return!0}function a(){clearTimeout(C),D=0,v&&I.setIdle(!1)}function c(e){(e=(e=e||window.event).relatedTarget||e.toElement)&&"HTML"!==e.nodeName||(clearTimeout(C),C=setTimeout(function(){I.setIdle(!0)},S.timeToIdleOutside))}function l(e){E!==e&&(P(w,"preloader--active",!e),E=e)}function N(e){var t,n=e.vGap;!o.likelyTouchDevice||S.mouseUsed||screen.width>S.fitControlsWidth?(t=S.barsSize,S.captionEl&&"auto"===t.bottom?(h||((h=r.createEl("pswp__caption pswp__caption--fake")).appendChild(r.createEl("pswp__caption__center")),u.insertBefore(h,p),r.addClass(u,"pswp__ui--fit")),S.addCaptionHTMLFn(e,h,!0)?(e=h.clientHeight,n.bottom=parseInt(e,10)||44):n.bottom=t.top):n.bottom="auto"===t.bottom?0:t.bottom,n.top=t.top):n.top=n.bottom=0}function M(){function e(e){if(e)for(var t=e.length,n=0;n<t;n++){s=e[n],i=s.className;for(var o=0;o<q.length;o++)a=q[o],-1<i.indexOf("pswp__"+a.name)&&(S[a.option]?(r.removeClass(s,"pswp__element--disabled"),a.onInit&&a.onInit(s)):r.addClass(s,"pswp__element--disabled"))}}e(u.children);var s,i,a,t=r.getChildByClass(u,"pswp__top-bar");t&&e(t.children)}var d,u,p,h,m,f,g,y,v,b,w,E,T,_,S,A,x,C,I=this,k=!1,L=!0,O=!0,F={barsSize:{top:44,bottom:"auto"},closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:4e3,timeToIdleOutside:1e3,loadingIndicatorDelay:1e3,addCaptionHTMLFn:function(e,t){return e.title?(t.children[0].innerHTML=e.title,!0):(t.children[0].innerHTML="",!1)},closeEl:!0,captionEl:!0,fullscreenEl:!0,zoomEl:!0,shareEl:!0,counterEl:!0,arrowEl:!0,preloaderEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,shareButtons:[{id:"facebook",label:"Share on Facebook",url:"https://www.facebook.com/sharer/sharer.php?u={{url}}"},{id:"twitter",label:"Tweet",url:"https://twitter.com/intent/tweet?text={{text}}&url={{url}}"},{id:"pinterest",label:"Pin it",url:"http://www.pinterest.com/pin/create/button/?url={{url}}&media={{image_url}}&description={{text}}"},{id:"download",label:"Download image",url:"{{raw_image_url}}",download:!0}],getImageURLForShare:function(){return o.currItem.src||""},getPageURLForShare:function(){return window.location.href},getTextForShare:function(){return o.currItem.title||""},indexIndicatorSep:" / ",fitControlsWidth:1200},P=function(e,t,n){r[(n?"add":"remove")+"Class"](e,"pswp__"+t)},R=function(){return(O=!O)?(r.removeClass(g,"pswp__share-modal--fade-in"),setTimeout(function(){O&&t()},300)):(t(),setTimeout(function(){O||r.addClass(g,"pswp__share-modal--fade-in")},30)),O||s(),!1},B=function(e){var t=(e=e||window.event).target||e.srcElement;return o.shout("shareLinkClick",e,t),!(!t.href||!t.hasAttribute("download")&&(window.open(t.href,"pswp_share","scrollbars=yes,resizable=yes,toolbar=no,location=yes,width=550,height=420,top=100,left="+(window.screen?Math.round(screen.width/2-275):100)),O||R(),1))},D=0,q=[{name:"caption",option:"captionEl",onInit:function(e){p=e}},{name:"share-modal",option:"shareEl",onInit:function(e){g=e},onTap:function(){R()}},{name:"button--share",option:"shareEl",onInit:function(e){f=e},onTap:function(){R()}},{name:"button--zoom",option:"zoomEl",onTap:o.toggleDesktopZoom},{name:"counter",option:"counterEl",onInit:function(e){m=e}},{name:"button--close",option:"closeEl",onTap:o.close},{name:"button--arrow--left",option:"arrowEl",onTap:o.prev},{name:"button--arrow--right",option:"arrowEl",onTap:o.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){d.isFullscreen()?d.exit():d.enter()}},{name:"preloader",option:"preloaderEl",onInit:function(e){w=e}}];I.init=function(){var t;r.extend(o.options,F,!0),S=o.options,u=r.getChildByClass(o.scrollWrap,"pswp__ui"),(b=o.listen)("onVerticalDrag",function(e){L&&e<.95?I.hideControls():!L&&.95<=e&&I.showControls()}),b("onPinchClose",function(e){L&&e<.9?(I.hideControls(),t=!0):t&&!L&&.9<e&&I.showControls()}),b("zoomGestureEnded",function(){(t=!1)&&!L&&I.showControls()}),b("beforeChange",I.update),b("doubleTap",function(e){var t=o.currItem.initialZoomLevel;o.getZoomLevel()!==t?o.zoomTo(t,e,333):o.zoomTo(S.getDoubleTapZoom(!1,o.currItem),e,333)}),b("preventDragEvent",function(e,t,n){var o=e.target||e.srcElement;o&&o.getAttribute("class")&&-1<e.type.indexOf("mouse")&&(0<o.getAttribute("class").indexOf("__caption")||/(SMALL|STRONG|EM)/i.test(o.tagName))&&(n.prevent=!1)}),b("bindEvents",function(){r.bind(u,"pswpTap click",e),r.bind(o.scrollWrap,"pswpTap",I.onGlobalTap),o.likelyTouchDevice||r.bind(o.scrollWrap,"mouseover",I.onMouseOver)}),b("unbindEvents",function(){O||R(),x&&clearInterval(x),r.unbind(document,"mouseout",c),r.unbind(document,"mousemove",a),r.unbind(u,"pswpTap click",e),r.unbind(o.scrollWrap,"pswpTap",I.onGlobalTap),r.unbind(o.scrollWrap,"mouseover",I.onMouseOver),d&&(r.unbind(document,d.eventK,I.updateFullscreen),d.isFullscreen()&&(S.hideAnimationDuration=0,d.exit()),d=null)}),b("destroy",function(){S.captionEl&&(h&&u.removeChild(h),r.removeClass(p,"pswp__caption--empty")),g&&(g.children[0].onclick=null),r.removeClass(u,"pswp__ui--over-close"),r.addClass(u,"pswp__ui--hidden"),I.setIdle(!1)}),S.showAnimationDuration||r.removeClass(u,"pswp__ui--hidden"),b("initialZoomIn",function(){S.showAnimationDuration&&r.removeClass(u,"pswp__ui--hidden")}),b("initialZoomOut",function(){r.addClass(u,"pswp__ui--hidden")}),b("parseVerticalMargin",N),M(),S.shareEl&&f&&g&&(O=!0),n(),S.timeToIdle&&b("mouseUsed",function(){r.bind(document,"mousemove",a),r.bind(document,"mouseout",c),x=setInterval(function(){2===++D&&I.setIdle(!0)},S.timeToIdle/2)}),S.fullscreenEl&&!r.features.isOldAndroid&&((d=d||I.getFullscreenAPI())?(r.bind(document,d.eventK,I.updateFullscreen),I.updateFullscreen(),r.addClass(o.template,"pswp--supports-fs")):r.removeClass(o.template,"pswp--supports-fs")),S.preloaderEl&&(l(!0),b("beforeChange",function(){clearTimeout(T),T=setTimeout(function(){o.currItem&&o.currItem.loading?o.allowProgressiveImg()&&(!o.currItem.img||o.currItem.img.naturalWidth)||l(!1):l(!0)},S.loadingIndicatorDelay)}),b("imageLoadComplete",function(e,t){o.currItem===t&&l(!0)}))},I.setIdle=function(e){P(u,"ui--idle",v=e)},I.update=function(){k=!(!L||!o.currItem||(I.updateIndexIndicator(),S.captionEl&&(S.addCaptionHTMLFn(o.currItem,p),P(p,"caption--empty",!o.currItem.title)),0)),O||R(),n()},I.updateFullscreen=function(e){e&&setTimeout(function(){o.setScrollOffset(0,r.getScrollY())},50),r[(d.isFullscreen()?"add":"remove")+"Class"](o.template,"pswp--fs")},I.updateIndexIndicator=function(){S.counterEl&&(m.innerHTML=o.getCurrentIndex()+1+S.indexIndicatorSep+S.getNumItemsFn())},I.onGlobalTap=function(e){var t=(e=e||window.event).target||e.srcElement;if(!A)if(e.detail&&"mouse"===e.detail.pointerType)i(t)?o.close():r.hasClass(t,"pswp__img")&&(1===o.getZoomLevel()&&o.getZoomLevel()<=o.currItem.fitRatio?S.clickToCloseNonZoomable&&o.close():o.toggleDesktopZoom(e.detail.releasePoint));else if(S.tapToToggleControls&&(L?I.hideControls():I.showControls()),S.tapToClose&&(r.hasClass(t,"pswp__img")||i(t)))return void o.close()},I.onMouseOver=function(e){e=(e=e||window.event).target||e.srcElement;P(u,"ui--over-close",i(e))},I.hideControls=function(){r.addClass(u,"pswp__ui--hidden"),L=!1},I.showControls=function(){L=!0,k||I.update(),r.removeClass(u,"pswp__ui--hidden")},I.supportsFullscreen=function(){var e=document;return!!(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen)},I.getFullscreenAPI=function(){var e,t=document.documentElement,n="fullscreenchange";return t.requestFullscreen?e={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:n}:t.mozRequestFullScreen?e={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+n}:t.webkitRequestFullscreen?e={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+n}:t.msRequestFullscreen&&(e={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),e&&(e.enter=function(){return y=S.closeOnScroll,S.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK?o.template[this.enterK]():void o.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},e.exit=function(){return S.closeOnScroll=y,document[this.exitK]()},e.isFullscreen=function(){return document[this.elementK]}),e}}}),((e,t)=>{"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.PhotoSwipe=t()})(this,function(){return function(p,M,t,F){var h={features:null,bind:function(e,t,n,o){var s=(o?"remove":"add")+"EventListener";t=t.split(" ");for(var i=0;i<t.length;i++)t[i]&&e[s](t[i],n,!1)},isArray:function(e){return e instanceof Array},createEl:function(e,t){t=document.createElement(t||"div");return e&&(t.className=e),t},getScrollY:function(){var e=window.pageYOffset;return void 0!==e?e:document.documentElement.scrollTop},unbind:function(e,t,n){h.bind(e,t,n,!0)},removeClass:function(e,t){t=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(t," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(e,t){h.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},hasClass:function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},getChildByClass:function(e,t){for(var n=e.firstChild;n;){if(h.hasClass(n,t))return n;n=n.nextSibling}},arraySearch:function(e,t,n){for(var o=e.length;o--;)if(e[o][n]===t)return o;return-1},extend:function(e,t,n){for(var o in t)if(t.hasOwnProperty(o)){if(n&&e.hasOwnProperty(o))continue;e[o]=t[o]}},easing:{sine:{out:function(e){return Math.sin(e*(Math.PI/2))},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{out:function(e){return--e*e*e+1}}},detectFeatures:function(){if(h.features)return h.features;var e,t,n=h.createEl().style,o="",s={};s.oldIE=document.all&&!document.addEventListener,s.touch="ontouchstart"in window,window.requestAnimationFrame&&(s.raf=window.requestAnimationFrame,s.caf=window.cancelAnimationFrame),s.pointerEvent=!!window.PointerEvent||navigator.msPointerEnabled,s.pointerEvent||(e=navigator.userAgent,/iP(hone|od)/.test(navigator.platform)&&(t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/))&&0<t.length&&1<=(t=parseInt(t[1],10))&&t<8&&(s.isOldIOSPhone=!0),t=(t=e.match(/Android\s([0-9\.]*)/))?t[1]:0,1<=(t=parseFloat(t))&&(t<4.4&&(s.isOldAndroid=!0),s.androidVersion=t),s.isMobileOpera=/opera mini|opera mobi/i.test(e));for(var i,a,r,c=["transform","perspective","animationName"],l=["","webkit","Moz","ms","O"],d=0;d<4;d++){for(var o=l[d],u=0;u<3;u++)i=c[u],a=o+(o?i.charAt(0).toUpperCase()+i.slice(1):i),!s[i]&&a in n&&(s[i]=a);o&&!s.raf&&(o=o.toLowerCase(),s.raf=window[o+"RequestAnimationFrame"],s.raf)&&(s.caf=window[o+"CancelAnimationFrame"]||window[o+"CancelRequestAnimationFrame"])}return s.raf||(r=0,s.raf=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-r)),o=window.setTimeout(function(){e(t+n)},n);return r=t+n,o},s.caf=function(e){clearTimeout(e)}),s.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,h.features=s}},m=(h.detectFeatures(),h.features.oldIE&&(h.bind=function(e,t,n,o){t=t.split(" ");for(var s,i=(o?"detach":"attach")+"Event",a=function(){n.handleEvent.call(n)},r=0;r<t.length;r++)if(s=t[r])if("object"==typeof n&&n.handleEvent){if(o){if(!n["oldIE"+s])return!1}else n["oldIE"+s]=a;e[i]("on"+s,n["oldIE"+s])}else e[i]("on"+s,n)}),this),B=25,f={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e||t.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};h.extend(f,F);function e(){return{x:0,y:0}}function H(e,t){h.extend(m,t.publicMethods),je.push(e)}function U(e){var t=R();return t-1<e?e-t:e<0?t+e:e}function i(e,t){return Ke[e]||(Ke[e]=[]),Ke[e].push(t)}function z(e,t,n,o){o===m.currItem.initialZoomLevel?n[e]=m.currItem.initialPosition[e]:(n[e]=Je(e,o),n[e]>t.min[e]?n[e]=t.min[e]:n[e]<t.max[e]&&(n[e]=t.max[e]))}function W(e){var t="";f.escKey&&27===e.keyCode?t="close":f.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),!t||e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,m[t]())}function G(e){e&&(ke||Ie||v||Ae)&&(e.preventDefault(),e.stopPropagation())}function j(){m.setScrollOffset(0,h.getScrollY())}function Y(e){var t;"mousedown"===e.type&&0<e.button||(Jt?e.preventDefault():xe&&"mousedown"===e.type||(Ot(e,!0)&&e.preventDefault(),_("pointerDown"),he&&((t=h.arraySearch(ft,e.pointerId,"id"))<0&&(t=ft.length),ft[t]={x:e.pageX,y:e.pageY,id:e.pointerId}),e=(t=Bt(e)).length,l=null,lt(),c&&1!==e||(c=qe=!0,h.bind(window,ee,m),Se=Fe=Ne=Ae=Oe=ke=Ce=Ie=!1,De=null,_("firstTouchStart",t),C(Ue,b),He.x=He.y=0,C(O,t[0]),C(mt,O),gt.x=E.x*ze,yt=[{x:O.x,y:O.y}],Te=Ee=S(),ot(y,!0),xt(),Ct()),!d&&1<e&&!v&&!Oe&&(ne=y,d=Ce=!(Ie=!1),He.y=He.x=0,C(Ue,b),C(k,t[0]),C(ht,t[1]),Rt(k,ht,_t),Tt.x=Math.abs(_t.x)-b.x,Tt.y=Math.abs(_t.y)-b.y,Pe=At(k,ht))))}function Z(e){var t;e.preventDefault(),he&&-1<(t=h.arraySearch(ft,e.pointerId,"id"))&&((t=ft[t]).x=e.pageX,t.y=e.pageY),c&&(t=Bt(e),De||ke||d?l=t:P.x!==E.x*ze?De="h":(e=Math.abs(t[0].x-O.x)-Math.abs(t[0].y-O.y),Math.abs(e)>=pt&&(De=0<e?"h":"v",l=t)))}function K(e){if(r.isOldAndroid){if(xe&&"mouseup"===e.type)return;-1<e.type.indexOf("touch")&&(clearTimeout(xe),xe=setTimeout(function(){xe=0},600))}var t;_("pointerUp"),Ot(e,!1)&&e.preventDefault(),he&&-1<(i=h.arraySearch(ft,e.pointerId,"id"))&&(t=ft.splice(i,1)[0],navigator.msPointerEnabled&&(t.type={4:"mouse",2:"touch",3:"pen"}[e.pointerType],t.type)||(t.type=e.pointerType||"mouse"));var n=(i=Bt(e)).length;if(2===(n="mouseup"===e.type?0:n))return!(l=null);1===n&&C(mt,i[0]),0!==n||De||v||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),_("touchRelease",e,t));var o,s,i=-1;if(0===n&&(c=!1,h.unbind(window,ee,m),xt(),d?i=0:-1!==Et&&(i=S()-Et)),Et=1===n?S():-1,e=-1!==i&&i<150?"zoom":"swipe",d&&n<2&&(d=!1,1===n&&(e="zoomPointerUp"),_("zoomGestureEnded")),l=null,ke||Ie||v||Ae)if(lt(),(_e=_e||zt()).calculateSwipeSpeed("x"),Ae)qt()<f.verticalDragRange?m.close():(o=b.y,s=Me,dt("verticalDrag",0,1,300,h.easing.cubic.out,function(e){b.y=(m.currItem.initialPosition.y-o)*e+o,A((1-s)*e+s),x()}),_("onVerticalDrag",1));else{if((Oe||v)&&0===n){if(Gt(e,_e))return;e="zoomPointerUp"}if(!v)return"swipe"!==e?void Yt():void(!Oe&&y>m.currItem.fitRatio&&Wt(_e))}}var Q,V,$,g,X,J,ee,te,o,y,ne,oe,se,ie,ae,a,re,ce,le,de,ue,pe,he,s,me,fe,ge,ye,ve,be,r,we,Ee,Te,_e,Se,Ae,xe,c,Ce,Ie,ke,Le,Oe,l,d,Pe,u,Re,v,De,qe,Ne,Me,Fe,Be,He=e(),Ue=e(),b=e(),w={},ze=0,We={},E=e(),T=0,Ge=!0,je=[],Ye={},Ze=!1,Ke={},_=function(e){var t=Ke[e];if(t){var n=Array.prototype.slice.call(arguments);n.shift();for(var o=0;o<t.length;o++)t[o].apply(m,n)}},S=function(){return(new Date).getTime()},A=function(e){Me=e,m.bg.style.opacity=e*f.bgOpacity},Qe=function(e,t,n,o,s){(!Ze||s&&s!==m.currItem)&&(o/=(s||m.currItem).fitRatio),e[pe]=oe+t+"px, "+n+"px"+se+" scale("+o+")"},x=function(e){Re&&(e&&(y>m.currItem.fitRatio?Ze||(ln(m.currItem,!1,!0),Ze=!0):Ze&&(ln(m.currItem),Ze=!1)),Qe(Re,b.x,b.y,y))},Ve=function(e){e.container&&Qe(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel,e)},$e=function(e,t){t[pe]=oe+e+"px, 0px"+se},Xe=function(e,t){var n;!f.loop&&t&&(t=g+(E.x*ze-e)/E.x,n=Math.round(e-P.x),t<0&&0<n||t>=R()-1&&n<0)&&(e=P.x+n*f.mainScrollEndFriction),P.x=e,$e(e,X)},Je=function(e,t){var n=Tt[e]-We[e];return Ue[e]+He[e]+n-t/ne*n},C=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},et=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},tt=null,nt=function(){tt&&(h.unbind(document,"mousemove",nt),h.addClass(p,"pswp--has_mouse"),f.mouseUsed=!0,_("mouseUsed")),tt=setTimeout(function(){tt=null},100)},ot=function(e,t){e=rn(m.currItem,w,e);return t&&(u=e),e},st=function(e){return(e=e||m.currItem).initialZoomLevel},it=function(e){return 0<(e=e||m.currItem).w?f.maxSpreadZoom:1},I={},at=0,rt=function(e){I[e]&&(I[e].raf&&fe(I[e].raf),at--,delete I[e])},ct=function(e){I[e]&&rt(e),I[e]||(at++,I[e]={})},lt=function(){for(var e in I)I.hasOwnProperty(e)&&rt(e)},dt=function(e,t,n,o,s,i,a){function r(){I[e]&&(c=S()-l,o<=c?(rt(e),i(n),a&&a()):(i((n-t)*s(c/o)+t),I[e].raf=me(r)))}var c,l=S();ct(e);r()},F={shout:_,listen:i,viewportSize:w,options:f,isMainScrollAnimating:function(){return v},getZoomLevel:function(){return y},getCurrentIndex:function(){return g},isDragging:function(){return c},isZooming:function(){return d},setScrollOffset:function(e,t){We.x=e,be=We.y=t,_("updateScrollOffset",We)},applyZoomPan:function(e,t,n,o){b.x=t,b.y=n,y=e,x(o)},init:function(){if(!Q&&!V){m.framework=h,m.template=p,m.bg=h.getChildByClass(p,"pswp__bg"),ge=p.className,Q=!0,r=h.detectFeatures(),me=r.raf,fe=r.caf,pe=r.transform,ve=r.oldIE,m.scrollWrap=h.getChildByClass(p,"pswp__scroll-wrap"),m.container=h.getChildByClass(m.scrollWrap,"pswp__container"),X=m.container.style,m.itemHolders=a=[{el:m.container.children[0],wrap:0,index:-1},{el:m.container.children[1],wrap:0,index:-1},{el:m.container.children[2],wrap:0,index:-1}],a[0].el.style.display=a[2].el.style.display="none",pe?(t=r.perspective&&!s,oe="translate"+(t?"3d(":"("),se=r.perspective?", 0px)":")"):(pe="left",h.addClass(p,"pswp--ie"),$e=function(e,t){t.left=e+"px"},Ve=function(e){var t=1<e.fitRatio?1:e.fitRatio,n=e.container.style,o=t*e.h;n.width=t*e.w+"px",n.height=o+"px",n.left=e.initialPosition.x+"px",n.top=e.initialPosition.y+"px"},x=function(){var e,t,n,o;Re&&(e=Re,o=(n=1<(t=m.currItem).fitRatio?1:t.fitRatio)*t.h,e.width=n*t.w+"px",e.height=o+"px",e.left=b.x+"px",e.top=b.y+"px")}),o={resize:m.updateSize,orientationchange:function(){clearTimeout(we),we=setTimeout(function(){w.x!==m.scrollWrap.clientWidth&&m.updateSize()},500)},scroll:j,keydown:W,click:G};var e,t=r.isOldIOSPhone||r.isOldAndroid||r.isMobileOpera;for(r.animationName&&r.transform&&!t||(f.showAnimationDuration=f.hideAnimationDuration=0),e=0;e<je.length;e++)m["init"+je[e]]();M&&(m.ui=new M(m,h)).init(),_("firstUpdate"),g=g||f.index||0,(isNaN(g)||g<0||g>=R())&&(g=0),m.currItem=en(g),(r.isOldIOSPhone||r.isOldAndroid)&&(Ge=!1),p.setAttribute("aria-hidden","false"),f.modal&&(Ge?p.style.position="fixed":(p.style.position="absolute",p.style.top=h.getScrollY()+"px")),void 0===be&&(_("initialLayout"),be=ye=h.getScrollY());var n="pswp--open ";for(f.mainClass&&(n+=f.mainClass+" "),f.showHideOpacity&&(n+="pswp--animate_opacity "),n=(n=(n+=s?"pswp--touch":"pswp--notouch")+(r.animationName?" pswp--css_animation":""))+(r.svg?" pswp--svg":""),h.addClass(p,n),m.updateSize(),J=-1,T=null,e=0;e<3;e++)$e((e+J)*E.x,a[e].el.style);ve||h.bind(m.scrollWrap,te,m),i("initialZoomInEnd",function(){m.setContent(a[0],g-1),m.setContent(a[2],g+1),a[0].el.style.display=a[2].el.style.display="block",f.focus&&p.focus(),h.bind(document,"keydown",m),r.transform&&h.bind(m.scrollWrap,"click",m),f.mouseUsed||h.bind(document,"mousemove",nt),h.bind(window,"resize scroll orientationchange",m),_("bindEvents")}),m.setContent(a[1],g),m.updateCurrItem(),_("afterInit"),Ge||(ie=setInterval(function(){at||c||d||y!==m.currItem.initialZoomLevel||m.updateSize()},1e3)),h.addClass(p,"pswp--visible")}var t},close:function(){Q&&(V=!(Q=!1),_("close"),h.unbind(window,"resize scroll orientationchange",m),h.unbind(window,"scroll",o.scroll),h.unbind(document,"keydown",m),h.unbind(document,"mousemove",nt),r.transform&&h.unbind(m.scrollWrap,"click",m),c&&h.unbind(window,ee,m),clearTimeout(we),_("unbindEvents"),tn(m.currItem,null,!0,m.destroy))},destroy:function(){_("destroy"),Vt&&clearTimeout(Vt),p.setAttribute("aria-hidden","true"),p.className=ge,ie&&clearInterval(ie),h.unbind(m.scrollWrap,te,m),h.unbind(window,"scroll",m),xt(),lt(),Ke=null},panTo:function(e,t,n){n||(e>u.min.x?e=u.min.x:e<u.max.x&&(e=u.max.x),t>u.min.y?t=u.min.y:t<u.max.y&&(t=u.max.y)),b.x=e,b.y=t,x()},handleEvent:function(e){e=e||window.event,o[e.type]&&o[e.type](e)},goTo:function(e){var t=(e=U(e))-g;T=t,g=e,m.currItem=en(g),ze-=t,Xe(E.x*ze),lt(),v=!1,m.updateCurrItem()},next:function(){m.goTo(g+1)},prev:function(){m.goTo(g-1)},updateCurrZoomItem:function(e){var t;e&&_("beforeChange",0),Re=a[1].el.children.length&&(t=a[1].el.children[0],h.hasClass(t,"pswp__zoom-wrap"))?t.style:null,u=m.currItem.bounds,ne=y=m.currItem.initialZoomLevel,b.x=u.center.x,b.y=u.center.y,e&&_("afterChange")},invalidateCurrItems:function(){ae=!0;for(var e=0;e<3;e++)a[e].item&&(a[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==T){var t,n=Math.abs(T);if(!(e&&n<2)){m.currItem=en(g),Ze=!1,_("beforeChange",T),3<=n&&(J+=T+(0<T?-3:3),n=3);for(var o=0;o<n;o++)0<T?(t=a.shift(),a[2]=t,$e((++J+2)*E.x,t.el.style),m.setContent(t,g-n+o+1+1)):(t=a.pop(),a.unshift(t),$e(--J*E.x,t.el.style),m.setContent(t,g+n-o-1-1));Re&&1===Math.abs(T)&&(e=en(re)).initialZoomLevel!==y&&(rn(e,w),ln(e),Ve(e)),T=0,m.updateCurrZoomItem(),re=g,_("afterChange")}}},updateSize:function(e){if(!Ge&&f.modal){var t=h.getScrollY();if(be!==t&&(p.style.top=t+"px",be=t),!e&&Ye.x===window.innerWidth&&Ye.y===window.innerHeight)return;Ye.x=window.innerWidth,Ye.y=window.innerHeight,p.style.height=Ye.y+"px"}if(w.x=m.scrollWrap.clientWidth,w.y=m.scrollWrap.clientHeight,j(),E.x=w.x+Math.round(w.x*f.spacing),E.y=w.y,Xe(E.x*ze),_("beforeResize"),void 0!==J){for(var n,o,s,i=0;i<3;i++)n=a[i],$e((i+J)*E.x,n.el.style),s=g+i-1,f.loop&&2<R()&&(s=U(s)),(o=en(s))&&(ae||o.needsUpdate||!o.bounds)?(m.cleanSlide(o),m.setContent(n,s),1===i&&(m.currItem=o,m.updateCurrZoomItem(!0)),o.needsUpdate=!1):-1===n.index&&0<=s&&m.setContent(n,s),o&&o.container&&(rn(o,w),ln(o),Ve(o));ae=!1}ne=y=m.currItem.initialZoomLevel,(u=m.currItem.bounds)&&(b.x=u.center.x,b.y=u.center.y,x(!0)),_("resize")},zoomTo:function(t,e,n,o,s){e&&(ne=y,Tt.x=Math.abs(e.x)-b.x,Tt.y=Math.abs(e.y)-b.y,C(Ue,b));function i(e){1===e?(y=t,b.x=a.x,b.y=a.y):(y=(t-r)*e+r,b.x=(a.x-c.x)*e+c.x,b.y=(a.y-c.y)*e+c.y),s&&s(e),x(1===e)}var e=ot(t,!1),a={},r=(z("x",e,a,t),z("y",e,a,t),y),c={x:b.x,y:b.y};et(a);n?dt("customZoomTo",0,1,n,o||h.easing.sine.inOut,i):i(1)}},ut=30,pt=10,k={},ht={},L={},O={},mt={},ft=[],gt={},yt=[],vt={},bt=0,wt=e(),Et=0,P=e(),Tt=e(),_t=e(),St=function(e,t){return e.x===t.x&&e.y===t.y},At=function(e,t){return vt.x=Math.abs(e.x-t.x),vt.y=Math.abs(e.y-t.y),Math.sqrt(vt.x*vt.x+vt.y*vt.y)},xt=function(){Le&&(fe(Le),Le=null)},Ct=function(){c&&(Le=me(Ct),Ut())},It=function(){return!("fit"===f.scaleMode&&y===m.currItem.initialZoomLevel)},kt=function(e,t){return!(!e||e===document)&&!(e.getAttribute("class")&&-1<e.getAttribute("class").indexOf("pswp__scroll-wrap"))&&(t(e)?e:kt(e.parentNode,t))},Lt={},Ot=function(e,t){return Lt.prevent=!kt(e.target,f.isClickableElement),_("preventDragEvent",e,t,Lt),Lt.prevent},Pt=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},Rt=function(e,t,n){n.x=.5*(e.x+t.x),n.y=.5*(e.y+t.y)},Dt=function(e,t,n){var o;50<e-Te&&((o=2<yt.length?yt.shift():{}).x=t,o.y=n,yt.push(o),Te=e)},qt=function(){var e=b.y-m.currItem.initialPosition.y;return 1-Math.abs(e/(w.y/2))},Nt={},Mt={},Ft=[],Bt=function(e){for(;0<Ft.length;)Ft.pop();return he?(Be=0,ft.forEach(function(e){0===Be?Ft[0]=e:1===Be&&(Ft[1]=e),Be++})):-1<e.type.indexOf("touch")?e.touches&&0<e.touches.length&&(Ft[0]=Pt(e.touches[0],Nt),1<e.touches.length)&&(Ft[1]=Pt(e.touches[1],Mt)):(Nt.x=e.pageX,Nt.y=e.pageY,Nt.id="",Ft[0]=Nt),Ft},Ht=function(e,t){var n,o,s,i=b[e]+t[e],a=P.x+t.x,r=P.x-gt.x,c=i>u.min[e]||i<u.max[e]?f.panEndFriction:1,i=b[e]+t[e]*c;return!f.allowPanToNext&&y!==m.currItem.initialZoomLevel||(Re?"h"!==De||"x"!==e||Ie||(0<t[e]?(i>u.min[e]&&(c=f.panEndFriction,u.min[e],n=u.min[e]-Ue[e]),(n<=0||r<0)&&1<R()?(s=a,r<0&&a>gt.x&&(s=gt.x)):u.min.x!==u.max.x&&(o=i)):(i<u.max[e]&&(c=f.panEndFriction,u.max[e],n=Ue[e]-u.max[e]),(n<=0||0<r)&&1<R()?(s=a,0<r&&a<gt.x&&(s=gt.x)):u.min.x!==u.max.x&&(o=i))):s=a,"x"!==e)?void(v||Oe||y>m.currItem.fitRatio&&(b[e]+=t[e]*c)):(void 0!==s&&(Xe(s,!0),Oe=s!==gt.x),u.min.x!==u.max.x&&(void 0!==o?b.x=o:Oe||(b.x+=t.x*c)),void 0!==s)},Ut=function(){var e,t,n,o,s,i;l&&0!==(e=l.length)&&(C(k,l[0]),L.x=k.x-O.x,L.y=k.y-O.y,d&&1<e?(O.x=k.x,O.y=k.y,!L.x&&!L.y&&St(l[1],ht)||(C(ht,l[1]),Ie||(Ie=!0,_("zoomGestureStarted")),e=At(k,ht),(t=jt(e))>m.currItem.initialZoomLevel+m.currItem.initialZoomLevel/15&&(Fe=!0),n=1,o=st(),s=it(),t<o?f.pinchToClose&&!Fe&&ne<=m.currItem.initialZoomLevel?(A(i=1-(o-t)/(o/1.2)),_("onPinchClose",i),Ne=!0):t=o-(n=1<(n=(o-t)/o)?1:n)*(o/3):s<t&&(t=s+(n=1<(n=(t-s)/(6*o))?1:n)*o),n<0&&(n=0),Rt(k,ht,wt),He.x+=wt.x-_t.x,He.y+=wt.y-_t.y,C(_t,wt),b.x=Je("x",t),b.y=Je("y",t),Se=y<t,y=t,x())):De&&(qe&&(qe=!1,Math.abs(L.x)>=pt&&(L.x-=l[0].x-mt.x),Math.abs(L.y)>=pt)&&(L.y-=l[0].y-mt.y),O.x=k.x,O.y=k.y,0===L.x&&0===L.y||("v"===De&&f.closeOnVerticalDrag&&!It()?(He.y+=L.y,b.y+=L.y,i=qt(),Ae=!0,_("onVerticalDrag",i),A(i),x()):(Dt(S(),k.x,k.y),ke=!0,u=m.currItem.bounds,Ht("x",L)||(Ht("y",L),et(b),x())))))},zt=function(){var t,n,o={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(e){n=(1<yt.length?(t=S()-Te+50,yt[yt.length-2]):(t=S()-Ee,mt))[e],o.lastFlickOffset[e]=O[e]-n,o.lastFlickDist[e]=Math.abs(o.lastFlickOffset[e]),20<o.lastFlickDist[e]?o.lastFlickSpeed[e]=o.lastFlickOffset[e]/t:o.lastFlickSpeed[e]=0,Math.abs(o.lastFlickSpeed[e])<.1&&(o.lastFlickSpeed[e]=0),o.slowDownRatio[e]=.95,o.slowDownRatioReverse[e]=1-o.slowDownRatio[e],o.speedDecelerationRatio[e]=1},calculateOverBoundsAnimOffset:function(t,e){o.backAnimStarted[t]||(b[t]>u.min[t]?o.backAnimDestination[t]=u.min[t]:b[t]<u.max[t]&&(o.backAnimDestination[t]=u.max[t]),void 0!==o.backAnimDestination[t]&&(o.slowDownRatio[t]=.7,o.slowDownRatioReverse[t]=1-o.slowDownRatio[t],o.speedDecelerationRatioAbs[t]<.05)&&(o.lastFlickSpeed[t]=0,o.backAnimStarted[t]=!0,dt("bounceZoomPan"+t,b[t],o.backAnimDestination[t],e||300,h.easing.sine.out,function(e){b[t]=e,x()})))},calculateAnimOffset:function(e){o.backAnimStarted[e]||(o.speedDecelerationRatio[e]=o.speedDecelerationRatio[e]*(o.slowDownRatio[e]+o.slowDownRatioReverse[e]-o.slowDownRatioReverse[e]*o.timeDiff/10),o.speedDecelerationRatioAbs[e]=Math.abs(o.lastFlickSpeed[e]*o.speedDecelerationRatio[e]),o.distanceOffset[e]=o.lastFlickSpeed[e]*o.speedDecelerationRatio[e]*o.timeDiff,b[e]+=o.distanceOffset[e])},panAnimLoop:function(){I.zoomPan&&(I.zoomPan.raf=me(o.panAnimLoop),o.now=S(),o.timeDiff=o.now-o.lastNow,o.lastNow=o.now,o.calculateAnimOffset("x"),o.calculateAnimOffset("y"),x(),o.calculateOverBoundsAnimOffset("x"),o.calculateOverBoundsAnimOffset("y"),o.speedDecelerationRatioAbs.x<.05)&&o.speedDecelerationRatioAbs.y<.05&&(b.x=Math.round(b.x),b.y=Math.round(b.y),x(),rt("zoomPan"))}};return o},Wt=function(e){return e.calculateSwipeSpeed("y"),u=m.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05?(e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0):(ct("zoomPan"),e.lastNow=S(),void e.panAnimLoop())},Gt=function(e,t){var n,o,s;v||(bt=g),"swipe"===e&&(e=O.x-mt.x,i=t.lastFlickDist.x<10,ut<e&&(i||20<t.lastFlickOffset.x)?o=-1:e<-ut&&(i||t.lastFlickOffset.x<-20)&&(o=1)),o&&((g+=o)<0?(g=f.loop?R()-1:0,s=!0):g>=R()&&(g=f.loop?0:R()-1,s=!0),s&&!f.loop||(T+=o,ze-=o,n=!0));var e=E.x*ze,i=Math.abs(e-P.x),a=n||e>P.x==0<t.lastFlickSpeed.x?(a=0<Math.abs(t.lastFlickSpeed.x)?i/Math.abs(t.lastFlickSpeed.x):333,a=Math.min(a,400),Math.max(a,250)):333;return bt===g&&(n=!1),v=!0,_("mainScrollAnimStart"),dt("mainScroll",P.x,e,a,h.easing.cubic.out,Xe,function(){lt(),v=!1,bt=-1,!n&&bt===g||m.updateCurrItem(),_("mainScrollAnimComplete")}),n&&m.updateCurrItem(!0),n},jt=function(e){return 1/Pe*e*ne},Yt=function(){var e=y,t=st(),n=it();y<t?e=t:n<y&&(e=n);var o,s=Me;return Ne&&!Se&&!Fe&&y<t?m.close():(Ne&&(o=function(e){A((1-s)*e+s)}),m.zoomTo(e,0,200,h.easing.cubic.out,o)),!0};H("Gestures",{publicMethods:{initGestures:function(){function e(e,t,n,o,s){ce=e+t,le=e+n,de=e+o,ue=s?e+s:""}(he=r.pointerEvent)&&r.touch&&(r.touch=!1),he?navigator.msPointerEnabled?e("MSPointer","Down","Move","Up","Cancel"):e("pointer","down","move","up","cancel"):r.touch?(e("touch","start","move","end","cancel"),s=!0):e("mouse","down","move","up"),ee=le+" "+de+" "+ue,te=ce,he&&!s&&(s=1<navigator.maxTouchPoints||1<navigator.msMaxTouchPoints),m.likelyTouchDevice=s,o[ce]=Y,o[le]=Z,o[de]=K,ue&&(o[ue]=o[de]),r.touch&&(te+=" mousedown",ee+=" mousemove mouseup",o.mousedown=o[ce],o.mousemove=o[le],o.mouseup=o[de]),s||(f.allowPanToNext=!1)}}});function Zt(e){function t(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,n.onload=n.onerror=null,n=null}e.loading=!0,e.loaded=!1;var n=e.img=h.createEl("pswp__img","img");n.onload=t,n.onerror=function(){e.loadError=!0,t()},n.src=e.src}function Kt(e,t){return e.src&&e.loadError&&e.container&&(t&&(e.container.innerHTML=""),e.container.innerHTML=f.errorMsg.replace("%url%",e.src),1)}function Qt(){if(nn.length){for(var e,t=0;t<nn.length;t++)(e=nn[t]).holder.index===e.index&&cn(e.index,e.item,e.baseDiv,e.img,!1,e.clearPlaceholder);nn=[]}}var Vt,$t,Xt,Jt,en,R,tn=function(i,e,a,t){function r(){rt("initialZoom"),a?(m.template.removeAttribute("style"),m.bg.removeAttribute("style")):(A(1),e&&(e.style.display="block"),h.addClass(p,"pswp--animated-in"),_("initialZoom"+(a?"OutEnd":"InEnd"))),t&&t(),Jt=!1}Vt&&clearTimeout(Vt),Xt=Jt=!0,i.initialLayout?(c=i.initialLayout,i.initialLayout=null):c=f.getThumbBoundsFn&&f.getThumbBoundsFn(g);var c,l,d,u=a?f.hideAnimationDuration:f.showAnimationDuration;u&&c&&void 0!==c.x?(l=$,d=!m.currItem.src||m.currItem.loadError||f.showHideOpacity,i.miniImg&&(i.miniImg.style.webkitBackfaceVisibility="hidden"),a||(y=c.w/i.w,b.x=c.x,b.y=c.y-ye,m[d?"template":"bg"].style.opacity=.001,x()),ct("initialZoom"),a&&!l&&h.removeClass(p,"pswp--animated-in"),d&&(a?h[(l?"remove":"add")+"Class"](p,"pswp--animate_opacity"):setTimeout(function(){h.addClass(p,"pswp--animate_opacity")},30)),Vt=setTimeout(function(){var t,n,o,s,e;_("initialZoom"+(a?"Out":"In")),a?(t=c.w/i.w,n={x:b.x,y:b.y},o=y,s=Me,e=function(e){1===e?(y=t,b.x=c.x,b.y=c.y-be):(y=(t-o)*e+o,b.x=(c.x-n.x)*e+n.x,b.y=(c.y-be-n.y)*e+n.y),x(),d?p.style.opacity=1-e:A(s-e*s)},l?dt("initialZoom",0,1,u,h.easing.cubic.out,e,r):(e(1),Vt=setTimeout(r,u+20))):(y=i.initialZoomLevel,C(b,i.initialPosition),x(),A(1),d?p.style.opacity=1:A(1),Vt=setTimeout(r,u+20))},a?25:90)):(_("initialZoom"+(a?"Out":"In")),y=i.initialZoomLevel,C(b,i.initialPosition),x(),p.style.opacity=a?0:1,A(1),u?setTimeout(function(){r()},u):r())},D={},nn=[],on={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return $t.length}},sn=function(){return{center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}}},an=function(e,t,n){var o=e.bounds;o.center.x=Math.round((D.x-t)/2),o.center.y=Math.round((D.y-n)/2)+e.vGap.top,o.max.x=t>D.x?Math.round(D.x-t):o.center.x,o.max.y=n>D.y?Math.round(D.y-n)+e.vGap.top:o.center.y,o.min.x=t>D.x?0:o.center.x,o.min.y=n>D.y?e.vGap.top:o.center.y},rn=function(e,t,n){var o,s;return e.src&&!e.loadError?((o=!n)&&(e.vGap||(e.vGap={top:0,bottom:0}),_("parseVerticalMargin",e)),D.x=t.x,D.y=t.y-e.vGap.top-e.vGap.bottom,o&&(t=D.x/e.w,s=D.y/e.h,e.fitRatio=t<s?t:s,"orig"===(t=f.scaleMode)?n=1:"fit"===t&&(n=e.fitRatio),e.initialZoomLevel=n=1<n?1:n,e.bounds||(e.bounds=sn())),n?(an(e,e.w*n,e.h*n),o&&n===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds):void 0):(e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds=sn(),e.initialPosition=e.bounds.center,e.bounds)},cn=function(e,t,n,o,s,i){t.loadError||o&&(t.imageAppended=!0,ln(t,o,t===m.currItem&&Ze),n.appendChild(o),i)&&setTimeout(function(){t&&t.loaded&&t.placeholder&&(t.placeholder.style.display="none",t.placeholder=null)},500)},ln=function(e,t,n){var o;e.src&&(t=t||e.container.lastChild,o=n?e.w:Math.round(e.w*e.fitRatio),n=n?e.h:Math.round(e.h*e.fitRatio),e.placeholder&&!e.loaded&&(e.placeholder.style.width=o+"px",e.placeholder.style.height=n+"px"),t.style.width=o+"px",t.style.height=n+"px")};H("Controller",{publicMethods:{lazyLoadItem:function(e){e=U(e);var t=en(e);t&&(!t.loaded&&!t.loading||ae)&&(_("gettingData",e,t),t.src)&&Zt(t)},initController:function(){h.extend(f,on,!0),m.items=$t=t,en=m.getItemAt,R=f.getNumItemsFn,f.loop,R()<3&&(f.loop=!1),i("beforeChange",function(e){for(var t=f.preload,n=null===e||0<=e,o=Math.min(t[0],R()),s=Math.min(t[1],R()),i=1;i<=(n?s:o);i++)m.lazyLoadItem(g+i);for(i=1;i<=(n?o:s);i++)m.lazyLoadItem(g-i)}),i("initialLayout",function(){m.currItem.initialLayout=f.getThumbBoundsFn&&f.getThumbBoundsFn(g)}),i("mainScrollAnimComplete",Qt),i("initialZoomInEnd",Qt),i("destroy",function(){for(var e,t=0;t<$t.length;t++)(e=$t[t]).container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);nn=null})},getItemAt:function(e){return 0<=e&&void 0!==$t[e]&&$t[e]},allowProgressiveImg:function(){return f.forceProgressiveLoading||!s||f.mouseUsed||1200<screen.width},setContent:function(t,n){f.loop&&(n=U(n));var e=m.getItemAt(t.index);e&&(e.container=null);var o,s,i,e=m.getItemAt(n);e?(_("gettingData",n,e),t.index=n,s=(t.item=e).container=h.createEl("pswp__zoom-wrap"),!e.src&&e.html&&(e.html.tagName?s.appendChild(e.html):s.innerHTML=e.html),Kt(e),rn(e,w),!e.src||e.loadError||e.loaded?e.src&&!e.loadError&&((o=h.createEl("pswp__img","img")).style.opacity=1,o.src=e.src,ln(e,o),cn(n,e,s,o,!0)):(e.loadComplete=function(e){if(Q){if(t&&t.index===n){if(Kt(e,!0))return e.loadComplete=e.img=null,rn(e,w),Ve(e),void(t.index===g&&m.updateCurrZoomItem());e.imageAppended?!Jt&&e.placeholder&&(e.placeholder.style.display="none",e.placeholder=null):r.transform&&(v||Jt)?nn.push({item:e,baseDiv:s,img:e.img,index:n,holder:t,clearPlaceholder:!0}):cn(n,e,s,e.img,v||Jt,!0)}e.loadComplete=null,e.img=null,_("imageLoadComplete",n,e)}},h.features.transform&&(i="pswp__img pswp__img--placeholder",i+=e.msrc?"":" pswp__img--placeholder--blank",i=h.createEl(i,e.msrc?"img":""),e.msrc&&(i.src=e.msrc),ln(e,i),s.appendChild(i),e.placeholder=i),e.loading||Zt(e),m.allowProgressiveImg()&&(!Xt&&r.transform?nn.push({item:e,baseDiv:s,img:e.img,index:n,holder:t}):cn(n,e,s,e.img,!0,!0))),Xt||n!==g?Ve(e):(Re=s.style,tn(e,o||e.img)),t.el.innerHTML="",t.el.appendChild(s)):t.el.innerHTML=""},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});function dn(e,t,n){var o=document.createEvent("CustomEvent"),t={origEvent:e,target:e.target,releasePoint:t,pointerType:n||"touch"};o.initCustomEvent("pswpTap",!0,!0,t),e.target.dispatchEvent(o)}var un,q,pn={};H("Tap",{publicMethods:{initTap:function(){i("firstTouchStart",m.onTapStart),i("touchRelease",m.onTapRelease),i("destroy",function(){pn={},un=null})},onTapStart:function(e){1<e.length&&(clearTimeout(un),un=null)},onTapRelease:function(e,t){var n,o,s;!t||ke||Ce||at||(n=t,un&&(clearTimeout(un),un=null,o=n,s=pn,Math.abs(o.x-s.x)<B)&&Math.abs(o.y-s.y)<B?_("doubleTap",n):"mouse"===t.type?dn(e,t,"mouse"):"BUTTON"===e.target.tagName.toUpperCase()||h.hasClass(e.target,"pswp__single-tap")?dn(e,t):(C(pn,n),un=setTimeout(function(){dn(e,t),un=null},300)))}}}),H("DesktopZoom",{publicMethods:{initDesktopZoom:function(){ve||(s?i("mouseUsed",function(){m.setupDesktopZoom()}):m.setupDesktopZoom(!0))},setupDesktopZoom:function(e){q={};var t="wheel mousewheel DOMMouseScroll";i("bindEvents",function(){h.bind(p,t,m.handleMouseWheel)}),i("unbindEvents",function(){q&&h.unbind(p,t,m.handleMouseWheel)}),m.mouseZoomedIn=!1;function n(){m.mouseZoomedIn&&(h.removeClass(p,"pswp--zoomed-in"),m.mouseZoomedIn=!1),y<1?h.addClass(p,"pswp--zoom-allowed"):h.removeClass(p,"pswp--zoom-allowed"),s()}var o,s=function(){o&&(h.removeClass(p,"pswp--dragging"),o=!1)};i("resize",n),i("afterChange",n),i("pointerDown",function(){m.mouseZoomedIn&&(o=!0,h.addClass(p,"pswp--dragging"))}),i("pointerUp",s),e||n()},handleMouseWheel:function(e){if(y<=m.currItem.fitRatio)return f.modal&&(!f.closeOnScroll||at||c?e.preventDefault():pe&&2<Math.abs(e.deltaY)&&($=!0,m.close())),!0;if(e.stopPropagation(),q.x=0,"deltaX"in e)1===e.deltaMode?(q.x=18*e.deltaX,q.y=18*e.deltaY):(q.x=e.deltaX,q.y=e.deltaY);else if("wheelDelta"in e)e.wheelDeltaX&&(q.x=-.16*e.wheelDeltaX),q.y=e.wheelDeltaY?-.16*e.wheelDeltaY:-.16*e.wheelDelta;else{if(!("detail"in e))return;q.y=e.detail}ot(y,!0);var t=b.x-q.x,n=b.y-q.y;(f.modal||t<=u.min.x&&t>=u.max.x&&n<=u.min.y&&n>=u.max.y)&&e.preventDefault(),m.panTo(t,n)},toggleDesktopZoom:function(e){e=e||{x:w.x/2+We.x,y:w.y/2+We.y};var t=f.getDoubleTapZoom(!0,m.currItem),n=y===t;m.mouseZoomedIn=!n,m.zoomTo(n?m.currItem.initialZoomLevel:t,e,333),h[(n?"remove":"add")+"Class"](p,"pswp--zoomed-in")}}});function hn(){fn&&clearTimeout(fn),yn&&clearTimeout(yn)}function mn(){var e=xn(),t={};if(!(e.length<5)){var n,o=e.split("&");for(i=0;i<o.length;i++)!o[i]||(n=o[i].split("=")).length<2||(t[n[0]]=n[1]);if(f.galleryPIDs){for(var s=t.pid,i=t.pid=0;i<$t.length;i++)if($t[i].pid===s){t.pid=i;break}}else t.pid=parseInt(t.pid,10)-1;t.pid<0&&(t.pid=0)}return t}var fn,gn,yn,vn,bn,wn,n,En,Tn,_n,N,Sn,An={history:!0,galleryUID:1},xn=function(){return N.hash.substring(1)},Cn=function(){var e,t;yn&&clearTimeout(yn),at||c?yn=setTimeout(Cn,500):(vn?clearTimeout(gn):vn=!0,t=g+1,(e=en(g)).hasOwnProperty("pid")&&(t=e.pid),e=n+"&gid="+f.galleryUID+"&pid="+t,En||-1===N.hash.indexOf(e)&&(_n=!0),t=N.href.split("#")[0]+"#"+e,Sn?"#"+e!==window.location.hash&&history[En?"replaceState":"pushState"]("",document.title,t):En?N.replace(t):N.hash=e,En=!0,gn=setTimeout(function(){vn=!1},60))};H("History",{publicMethods:{initHistory:function(){var e,t;h.extend(f,An,!0),f.history&&(N=window.location,En=Tn=_n=!1,n=xn(),Sn="pushState"in history,-1<n.indexOf("gid=")&&(n=(n=n.split("&gid=")[0]).split("?gid=")[0]),i("afterChange",m.updateURL),i("unbindEvents",function(){h.unbind(window,"hashchange",m.onHashChange)}),e=function(){wn=!0,Tn||(_n?history.back():n?N.hash=n:Sn?history.pushState("",document.title,N.pathname+N.search):N.hash=""),hn()},i("unbindEvents",function(){$&&e()}),i("destroy",function(){wn||e()}),i("firstUpdate",function(){g=mn().pid}),-1<(t=n.indexOf("pid="))&&"&"===(n=n.substring(0,t)).slice(-1)&&(n=n.slice(0,-1)),setTimeout(function(){Q&&h.bind(window,"hashchange",m.onHashChange)},40))},onHashChange:function(){return xn()===n?(Tn=!0,void m.close()):void(vn||(bn=!0,m.goTo(mn().pid),bn=!1))},updateURL:function(){hn(),bn||(En?fn=setTimeout(Cn,800):Cn())}}}),h.extend(m,F)}}),((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).reframe=t()})(this,function(){function t(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var o=Array(e),s=0,t=0;t<n;t++)for(var i=arguments[t],a=0,r=i.length;a<r;a++,s++)o[s]=i[a];return o}return function(e,s){return void 0===s&&(s="js-reframe"),("string"==typeof e?t(document.querySelectorAll(e)):"length"in e?t(e):[e]).forEach(function(e){var t,n,o;-1!==e.className.split(" ").indexOf(s)||-1<e.style.width.indexOf("%")||(t=e.getAttribute("height")||e.offsetHeight,n=e.getAttribute("width")||e.offsetWidth,t=("string"==typeof t?parseInt(t):t)/("string"==typeof n?parseInt(n):n)*100,(n=document.createElement("div")).className=s,(o=n.style).position="relative",o.width="100%",o.paddingTop=t+"%",(o=e.style).position="absolute",o.width="100%",o.height="100%",o.left="0",o.top="0",null!=(t=e.parentNode)&&t.insertBefore(n,e),null!=(o=e.parentNode)&&o.removeChild(e),n.appendChild(e))})}}),(()=>{var e=document.querySelector(".gh-burger");e&&e.addEventListener("click",function(){document.body.classList.contains("is-head-open")?document.body.classList.remove("is-head-open"):document.body.classList.add("is-head-open")})})(),lightbox(".kg-image-card > .kg-image[width][height], .kg-gallery-image > img"),reframe(document.querySelectorAll(['.gh-content iframe[src*="youtube.com"]','.gh-content iframe[src*="youtube-nocookie.com"]','.gh-content iframe[src*="player.vimeo.com"]','.gh-content iframe[src*="kickstarter.com"][src*="video.html"]',".gh-content object",".gh-content embed"].join(","))),dropdown(),((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DOMPurify=t()})(this,function(){function Ye(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s(c,t)}let{entries:Ze,setPrototypeOf:i,isFrozen:a,getPrototypeOf:o,getOwnPropertyDescriptor:d}=Object,{freeze:Ke,seal:e,create:Qe}=Object,{apply:r,construct:s}="undefined"!=typeof Reflect&&Reflect,Ve=(Ke=Ke||function(e){return e},e=e||function(e){return e},r=r||function(e,t){for(var n=arguments.length,o=new Array(2<n?n-2:0),s=2;s<n;s++)o[s-2]=arguments[s];return e.apply(t,o)},s=s||function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return new e(...n)},l(Array.prototype.forEach)),wt=l(Array.prototype.lastIndexOf),$e=l(Array.prototype.pop),Xe=l(Array.prototype.push),Et=l(Array.prototype.splice),Je=l(String.prototype.toLowerCase),et=l(String.prototype.toString),tt=l(String.prototype.match),nt=l(String.prototype.replace),Tt=l(String.prototype.indexOf),_t=l(String.prototype.trim),ot=l(Object.prototype.hasOwnProperty),st=l(RegExp.prototype.test);c=TypeError;var c;function l(s){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r(s,e,n)}}function it(e,n,t){var o=2<arguments.length&&void 0!==t?t:Je;i&&i(e,null);let s=n.length;for(;s--;){let t=n[s];if("string"==typeof t){let e=o(t);e!==t&&(a(n)||(n[s]=e),t=e)}e[t]=!0}return e}function at(e){var t,n,o=Qe(null);for([t,n]of Ze(e))ot(e,t)&&(Array.isArray(n)?o[t]=(t=>{for(let e=0;e<t.length;e++)ot(t,e)||(t[e]=null);return t})(n):n&&"object"==typeof n&&n.constructor===Object?o[t]=at(n):o[t]=n);return o}function rt(e,t){for(;null!==e;){var n=d(e,t);if(n){if(n.get)return l(n.get);if("function"==typeof n.value)return l(n.value)}e=o(e)}return function(){return null}}let ct=Ke(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),lt=Ke(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),dt=Ke(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),St=Ke(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ut=Ke(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),At=Ke(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),pt=Ke(["#text"]),ht=Ke(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),mt=Ke(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ft=Ke(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),gt=Ke(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),t=e(/\{\{[\w\W]*|[\w\W]*\}\}/gm),n=e(/<%[\w\W]*|[\w\W]*%>/gm),u=e(/\$\{[\w\W]*/gm),p=e(/^data-[\-\w.\u00B7-\uFFFF]+$/),h=e(/^aria-[\-\w]+$/),yt=e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),m=e(/^(?:\w+script|data):/i),f=e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),vt=e(/^html$/i),g=e(/^[a-z][.\w]*(-[.\w]+)+$/i);var bt=Object.freeze({__proto__:null,ARIA_ATTR:h,ATTR_WHITESPACE:f,CUSTOM_ELEMENT:g,DATA_ATTR:p,DOCTYPE_NAME:vt,ERB_EXPR:n,IS_ALLOWED_URI:yt,IS_SCRIPT_OR_DATA:m,MUSTACHE_EXPR:t,TMPLIT_EXPR:u});let y=function N(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"undefined"==typeof window?null:window;let d=e=>N(e);if(d.version="3.3.0",d.removed=[],!e||!e.document||9!==e.document.nodeType||!e.Element)return d.isSupported=!1,d;let s=e.document,M=s,F=M.currentScript,{DocumentFragment:B,HTMLTemplateElement:H,Node:U,Element:z,NodeFilter:t,NamedNodeMap:W=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:G,DOMParser:j,trustedTypes:u}=e,n=z.prototype,Y=rt(n,"cloneNode"),Z=rt(n,"remove"),K=rt(n,"nextSibling"),Q=rt(n,"childNodes"),i=rt(n,"parentNode");if("function"==typeof H){let e=s.createElement("template");e.content&&e.content.ownerDocument&&(s=e.content.ownerDocument)}function V(e){return e instanceof RegExp||e instanceof Function}function $(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!R||R!==e){if(e=at(e=e&&"object"==typeof e?e:{}),O=-1===Me.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,P="application/xhtml+xml"===O?et:Je,l=ot(e,"ALLOWED_TAGS")?it({},e.ALLOWED_TAGS,P):ge,f=ot(e,"ALLOWED_ATTR")?it({},e.ALLOWED_ATTR,P):ye,De=ot(e,"ALLOWED_NAMESPACES")?it({},e.ALLOWED_NAMESPACES,et):qe,Oe=ot(e,"ADD_URI_SAFE_ATTR")?it(at(Pe),e.ADD_URI_SAFE_ATTR,P):Pe,ke=ot(e,"ADD_DATA_URI_TAGS")?it(at(Le),e.ADD_DATA_URI_TAGS,P):Le,S=ot(e,"FORBID_CONTENTS")?it({},e.FORBID_CONTENTS,P):Ie,g=ot(e,"FORBID_TAGS")?it({},e.FORBID_TAGS,P):at({}),ve=ot(e,"FORBID_ATTR")?it({},e.FORBID_ATTR,P):at({}),o=!!ot(e,"USE_PROFILES")&&e.USE_PROFILES,be=!1!==e.ALLOW_ARIA_ATTR,we=!1!==e.ALLOW_DATA_ATTR,Ee=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Te=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,y=e.SAFE_FOR_TEMPLATES||!1,v=!1!==e.SAFE_FOR_XML,b=e.WHOLE_DOCUMENT||!1,w=e.RETURN_DOM||!1,E=e.RETURN_DOM_FRAGMENT||!1,T=e.RETURN_TRUSTED_TYPE||!1,Se=e.FORCE_BODY||!1,Ae=!1!==e.SANITIZE_DOM,xe=e.SANITIZE_NAMED_PROPS||!1,Ce=!1!==e.KEEP_CONTENT,_=e.IN_PLACE||!1,fe=e.ALLOWED_URI_REGEXP||yt,I=e.NAMESPACE||C,k=e.MATHML_TEXT_INTEGRATION_POINTS||k,L=e.HTML_INTEGRATION_POINTS||L,a=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&V(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(a.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&V(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(a.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(a.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),y&&(we=!1),E&&(w=!0),o&&(l=it({},pt),f=[],!0===o.html&&(it(l,ct),it(f,ht)),!0===o.svg&&(it(l,lt),it(f,mt),it(f,gt)),!0===o.svgFilters&&(it(l,dt),it(f,mt),it(f,gt)),!0===o.mathMl)&&(it(l,ut),it(f,ft),it(f,gt)),e.ADD_TAGS&&("function"==typeof e.ADD_TAGS?r.tagCheck=e.ADD_TAGS:it(l=l===ge?at(l):l,e.ADD_TAGS,P)),e.ADD_ATTR&&("function"==typeof e.ADD_ATTR?r.attributeCheck=e.ADD_ATTR:it(f=f===ye?at(f):f,e.ADD_ATTR,P)),e.ADD_URI_SAFE_ATTR&&it(Oe,e.ADD_URI_SAFE_ATTR,P),e.FORBID_CONTENTS&&it(S=S===Ie?at(S):S,e.FORBID_CONTENTS,P),Ce&&(l["#text"]=!0),b&&it(l,["html","head","body"]),l.table&&(it(l,["tbody"]),delete g.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Ye('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Ye('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');h=e.TRUSTED_TYPES_POLICY,c=h.createHTML("")}else null!==(h=void 0===h?((e,t)=>{if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;var o="data-tt-policy-suffix",t="dompurify"+((n=t&&t.hasAttribute(o)?t.getAttribute(o):n)?"#"+n:"");try{return e.createPolicy(t,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+t+" could not be created."),null}})(u,F):h)&&"string"==typeof c&&(c=h.createHTML(""));Ke&&Ke(e),R=e}}function p(e,t){try{Xe(d.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){Xe(d.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(w||E)try{D(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}}function X(t){let e=null,n=null;if(Se)t="<remove></remove>"+t;else{let e=tt(t,/^[\r\n\t ]+/);n=e&&e[0]}"application/xhtml+xml"===O&&I===C&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");var o=h?h.createHTML(t):t;if(I===C)try{e=(new j).parseFromString(o,O)}catch(t){}if(!e||!e.documentElement){e=ne.createDocument(I,"template",null);try{e.documentElement.innerHTML=Re?c:o}catch(t){}}return o=e.body||e.documentElement,t&&n&&o.insertBefore(s.createTextNode(n),o.childNodes[0]||null),I===C?ie.call(e,b?"html":"body")[0]:b?e.documentElement:o}function J(e){return oe.call(e.ownerDocument||e,e,t.SHOW_ELEMENT|t.SHOW_COMMENT|t.SHOW_TEXT|t.SHOW_PROCESSING_INSTRUCTION|t.SHOW_CDATA_SECTION,null)}function ee(e){return e instanceof G&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof W)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)}function te(e){return"function"==typeof U&&e instanceof U}let h,c="",{implementation:ne,createNodeIterator:oe,createDocumentFragment:se,getElementsByTagName:ie}=s,ae=M.importNode,m={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]},{MUSTACHE_EXPR:re,ERB_EXPR:ce,TMPLIT_EXPR:le,DATA_ATTR:de,ARIA_ATTR:ue,IS_SCRIPT_OR_DATA:pe,ATTR_WHITESPACE:he,CUSTOM_ELEMENT:me}=(d.isSupported="function"==typeof Ze&&"function"==typeof i&&ne&&void 0!==ne.createHTMLDocument,bt),fe=bt.IS_ALLOWED_URI,l=null,ge=it({},[...ct,...lt,...dt,...ut,...pt]),f=null,ye=it({},[...ht,...mt,...ft,...gt]),a=Object.seal(Qe(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),g=null,ve=null,r=Object.seal(Qe(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),be=!0,we=!0,Ee=!1,Te=!0,y=!1,v=!0,b=!1,_e=!1,Se=!1,w=!1,E=!1,T=!1,Ae=!0,xe=!1,Ce=!0,_=!1,o={},S=null,Ie=it({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),ke=null,Le=it({},["audio","video","img","source","image","track"]),Oe=null,Pe=it({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),A="http://www.w3.org/1998/Math/MathML",x="http://www.w3.org/2000/svg",C="http://www.w3.org/1999/xhtml",I=C,Re,De=null,qe=it({},[A,x,C],et),k=it({},["mi","mo","mn","ms","mtext"]),L=it({},["annotation-xml"]),Ne=it({},["title","style","font","a","script"]),O=null,Me=["application/xhtml+xml","text/html"],P=null,R=null,Fe=s.createElement("form"),Be=it({},[...lt,...dt,...St]),He=it({},[...ut,...At]),D=function(t){Xe(d.removed,{element:t});try{i(t).removeChild(t)}catch(e){Z(t)}};function q(e,t,n){Ve(e,e=>{e.call(d,t,n,R)})}function Ue(o){let t=null;if(q(m.beforeSanitizeElements,o,null),!ee(o)){let e=P(o.nodeName);if(q(m.uponSanitizeElement,o,{tagName:e,allowedTags:l}),!(v&&o.hasChildNodes()&&!te(o.firstElementChild)&&st(/<[/\w!]/g,o.innerHTML)&&st(/<[/\w!]/g,o.textContent)||7===o.nodeType||v&&8===o.nodeType&&st(/<[/\w]/g,o.data))){if(r.tagCheck instanceof Function&&r.tagCheck(e)||l[e]&&!g[e])return(!(o instanceof z)||(e=>{let t=i(e);t&&t.tagName||(t={namespaceURI:I,tagName:"template"});var n=Je(e.tagName),o=Je(t.tagName);return De[e.namespaceURI]&&(e.namespaceURI===x?t.namespaceURI===C?"svg"===n:t.namespaceURI===A?"svg"===n&&("annotation-xml"===o||k[o]):Boolean(Be[n]):e.namespaceURI===A?t.namespaceURI===C?"math"===n:t.namespaceURI===x?"math"===n&&L[o]:Boolean(He[n]):e.namespaceURI===C?(t.namespaceURI!==x||L[o])&&(t.namespaceURI!==A||k[o])&&!He[n]&&(Ne[n]||!Be[n]):"application/xhtml+xml"===O&&De[e.namespaceURI])})(o))&&("noscript"!==e&&"noembed"!==e&&"noframes"!==e||!st(/<\/no(script|embed|frames)/i,o.innerHTML))?(y&&3===o.nodeType&&(t=o.textContent,Ve([re,ce,le],e=>{t=nt(t,e," ")}),o.textContent!==t)&&(Xe(d.removed,{element:o.cloneNode()}),o.textContent=t),q(m.afterSanitizeElements,o,null)):D(o);if(!g[e]&&je(e)){if(a.tagNameCheck instanceof RegExp&&st(a.tagNameCheck,e))return;if(a.tagNameCheck instanceof Function&&a.tagNameCheck(e))return}if(Ce&&!S[e]){let t=i(o)||o.parentNode,n=Q(o)||o.childNodes;if(n&&t)for(let e=n.length-1;0<=e;--e){var s=Y(n[e],!0);s.__removalCount=(o.__removalCount||0)+1,t.insertBefore(s,K(o))}}}}D(o)}function ze(e,t,n){if(Ae&&("id"===t||"name"===t)&&(n in s||n in Fe))return!1;if((!we||ve[t]||!st(de,t))&&!(be&&st(ue,t)||r.attributeCheck instanceof Function&&r.attributeCheck(t,e)))if(!f[t]||ve[t]){if(!(je(e)&&(a.tagNameCheck instanceof RegExp&&st(a.tagNameCheck,e)||a.tagNameCheck instanceof Function&&a.tagNameCheck(e))&&(a.attributeNameCheck instanceof RegExp&&st(a.attributeNameCheck,t)||a.attributeNameCheck instanceof Function&&a.attributeNameCheck(t,e))||"is"===t&&a.allowCustomizedBuiltInElements&&(a.tagNameCheck instanceof RegExp&&st(a.tagNameCheck,n)||a.tagNameCheck instanceof Function&&a.tagNameCheck(n))))return!1}else if(!Oe[t]&&!st(fe,nt(n,he,""))&&("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Tt(n,"data:")||!ke[e])&&(!Ee||st(pe,nt(n,he,"")))&&n)return!1;return!0}function We(n){q(m.beforeSanitizeAttributes,n,null);var o=n.attributes;if(o&&!ee(n)){var s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:f,forceKeepAttr:void 0};let e=o.length;for(;e--;){var{name:i,namespaceURI:a,value:r}=o[e],c=P(i);let t="value"===i?r:_t(r);if(s.attrName=c,s.attrValue=t,s.keepAttr=!0,s.forceKeepAttr=void 0,q(m.uponSanitizeAttribute,n,s),t=s.attrValue,!xe||"id"!==c&&"name"!==c||(p(i,n),t="user-content-"+t),v&&st(/((--!?|])>)|<\/(style|title|textarea)/i,t))p(i,n);else if("attributename"===c&&tt(t,"href"))p(i,n);else if(!s.forceKeepAttr)if(s.keepAttr)if(!Te&&st(/\/>/i,t))p(i,n);else{y&&Ve([re,ce,le],e=>{t=nt(t,e," ")});var l=P(n.nodeName);if(ze(l,c,t)){if(h&&"object"==typeof u&&"function"==typeof u.getAttributeType&&!a)switch(u.getAttributeType(l,c)){case"TrustedHTML":t=h.createHTML(t);break;case"TrustedScriptURL":t=h.createScriptURL(t)}if(t!==r)try{a?n.setAttributeNS(a,i,t):n.setAttribute(i,t),ee(n)?D(n):$e(d.removed)}catch(o){p(i,n)}}else p(i,n)}else p(i,n)}q(m.afterSanitizeAttributes,n,null)}}function Ge(e){var t,n=J(e);for(q(m.beforeSanitizeShadowDOM,e,null);t=n.nextNode();)q(m.uponSanitizeShadowNode,t,null),Ue(t),We(t),t.content instanceof B&&Ge(t.content);q(m.afterSanitizeShadowDOM,e,null)}let je=function(e){return"annotation-xml"!==e&&tt(e,me)};return d.sanitize=function(t){let e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=null,o,s,i=null;if("string"!=typeof(t=(Re=!t)?"\x3c!--\x3e":t)&&!te(t)){if("function"!=typeof t.toString)throw Ye("toString is not a function");if("string"!=typeof(t=t.toString()))throw Ye("dirty is not a string, aborting")}if(!d.isSupported)return t;if(_e||$(e),d.removed=[],_="string"==typeof t?!1:_){if(t.nodeName){let e=P(t.nodeName);if(!l[e]||g[e])throw Ye("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof U)1===(o=(n=X("\x3c!----\x3e")).ownerDocument.importNode(t,!0)).nodeType&&"BODY"===o.nodeName||"HTML"===o.nodeName?n=o:n.appendChild(o);else{if(!w&&!y&&!b&&-1===t.indexOf("<"))return h&&T?h.createHTML(t):t;if(!(n=X(t)))return w?null:T?c:""}n&&Se&&D(n.firstChild);for(var a=J(_?t:n);s=a.nextNode();)Ue(s),We(s),s.content instanceof B&&Ge(s.content);if(_)return t;if(w){if(E)for(i=se.call(n.ownerDocument);n.firstChild;)i.appendChild(n.firstChild);else i=n;return i=f.shadowroot||f.shadowrootmode?ae.call(M,i,!0):i}let r=b?n.outerHTML:n.innerHTML;return b&&l["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&st(vt,n.ownerDocument.doctype.name)&&(r="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+r),y&&Ve([re,ce,le],e=>{r=nt(r,e," ")}),h&&T?h.createHTML(r):r},d.setConfig=function(){$(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),_e=!0},d.clearConfig=function(){R=null,_e=!1},d.isValidAttribute=function(e,t,n){R||$({});e=P(e),t=P(t);return ze(e,t,n)},d.addHook=function(e,t){"function"==typeof t&&Xe(m[e],t)},d.removeHook=function(e,t){return void 0!==t?-1===(t=wt(m[e],t))?void 0:Et(m[e],t,1)[0]:$e(m[e])},d.removeHooks=function(e){m[e]=[]},d.removeAllHooks=function(){m={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},d}();return y}),(()=>{let l=window.PAYWALL_API_URL||"http://localhost:4000/api";if("success"===new URLSearchParams(window.location.search).get("purchase")){var t=window.location.pathname,t=(history.replaceState({},"",t),document.cookie.includes("ghost-members-ssr"));let e=document.getElementById("buy-article-btn");var n=e&&e.dataset.memberEmail,t=t||n;if(console.log("Purchase success - signed in:",t),t)console.log("Reloading for signed-in user"),window.location.reload();else{console.log("Opening signin portal for anonymous user");{let e=document.createElement("div"),t=(e.className="gh-purchase-success-overlay",document.createElement("div"));t.className="gh-purchase-success-message",t.innerHTML=`
      <h2> Purchase Complete!</h2>
      <p>Your member account has been created. Please sign in to access this article.</p>
      <p>Opening sign-in portal...</p>
    `,e.appendChild(t),document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}(n=document.querySelector('[data-portal="signin"]'))?(console.log("Opening Ghost signin portal..."),n.click()):console.error("No signin link found - Ghost portal may not be configured")}}(async()=>{var e=document.querySelector(".gh-post-upgrade-cta");if(e){var t=document.getElementById("buy-article-btn");if(t){var n=t.dataset.memberEmail;if(n){t=t.dataset.postId;if(t)try{var o,s,i,a,r=await(await fetch(l+"/verify-access",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:t,memberEmail:n,includeContent:!0})})).json();r.hasAccess&&(console.log(" Free member has access to this article - showing full content"),(o=document.querySelector(".gh-excerpt-wrapper"))&&(o.style.display="none"),e.style.display="none",(s=document.querySelector(".gh-full-content"))&&r.content?(i=window.DOMPurify?window.DOMPurify.sanitize(r.content):r.content,s.innerHTML=i,s.classList.add("gh-content"),s.style.display="block",console.log(" Full article content displayed"+(window.DOMPurify?" (sanitized)":""))):s&&(s.style.display="block",(a=s.querySelector(".gh-post-upgrade-cta"))&&(console.log(" Removing Ghost's injected paywall from content"),a.remove()),console.log(" Full article content displayed (fallback)")))}catch(e){console.error("Error checking article access:",e)}}}}})();let e=document.getElementById("buy-article-btn");e&&e.addEventListener("click",async function(t){t.preventDefault();var t=t.currentTarget,e=t.dataset.postId,n=t.dataset.postTitle,o=t.dataset.postUrl,s=t.dataset.memberEmail,i=t.dataset.memberName,a=(t.disabled=!0,document.getElementById("paywall-loading"));a&&(a.style.display="block");try{var r={postId:e,postTitle:n,postUrl:o};s&&(r.memberEmail=s,i)&&(r.memberName=i);var c=await(await fetch(l+"/create-tip-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json();if(!c.checkoutUrl)throw new Error("No checkout URL received");window.location.href=c.checkoutUrl}catch(e){console.error("Checkout error:",e),alert("Failed to create checkout. Please try again."),t.disabled=!1,a&&(a.style.display="none")}}),(t=document.querySelector('.gh-btn-upgrade[data-portal="signup"]'))&&t.addEventListener("click",function(e){e.preventDefault(),window.GhostMembers&&window.GhostMembers.openPortal("signup")}),document.querySelectorAll('[data-portal="signin"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),window.GhostMembers&&window.GhostMembers.openPortal("signin")})})})(),(()=>{let t="true"===new URLSearchParams(window.location.search).get("ppa_debug")||"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,l=(...e)=>t&&console.log(...e),d=(...e)=>t&&console.error(...e),u="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:4000/api":"https://ppa.fly.dev/api";function e(){l(" PPA: Initialized");let e=!1;var t,n,o;!0===window.PPA_ENABLED?(e=!0,l(" PPA: Feature enabled globally")):"check-post-id"===window.PPA_ENABLED&&window.PPA_TEST_POST_ID?(t=document.querySelector("article[data-post-id]")?.dataset.postId,e=t===window.PPA_TEST_POST_ID,l(" PPA: Checking post ID:",t,"===",window.PPA_TEST_POST_ID,"?",e)):l(" PPA: Feature disabled globally (set window.PPA_ENABLED = true to enable)"),e&&(window.location.search.includes("purchase=success")?(l(" PPA: Purchase successful, reloading to check access"),history.replaceState({},"",window.location.pathname),window.location.reload()):(t=document.querySelector(".gh-post-upgrade-cta"))?(n=document.querySelector("article[data-post-id]"))?n.dataset.memberEmail?(l(" PPA: Free member detected - checking purchase status"),(async(t,n)=>{var e=n.dataset.postId,o=n.dataset.memberEmail;try{l(" PPA: Step 1 - Verifying access");var s,i,a,r,c=await(await fetch(u+"/verify-access",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:e,memberEmail:o})})).json();c.hasAccess?c.accessToken?(l(" PPA: Access verified, token received"),l(" PPA: Step 2 - Fetching content with token"),(s=await fetch(u+`/get-content/${e}?token=`+c.accessToken)).ok?(a=await s.json()).html?(l(" PPA: Access granted - removing paywall and showing content"),t.remove(),(r=document.querySelector(".gh-content"))&&(r.innerHTML=a.html,l(" PPA: Full content injected"))):(d(" PPA: No content in response"),p(t,n)):(i=await s.json(),d(" PPA: Content fetch failed:",i),403===s.status?"expired"===i.reason?(d(" PPA: Token expired, please refresh"),alert("Session expired. Please refresh the page.")):"invalid_signature"===i.reason&&d(" PPA: Invalid token signature"):429===s.status&&(d(" PPA: Rate limit exceeded"),alert("Too many requests. Please wait a moment and refresh.")),p(t,n))):(d(" PPA: Access granted but no token received"),p(t,n)):(l(" PPA: No access - showing buy option"),p(t,n))}catch(e){d(" PPA: Access check failed:",e),p(t,n)}})(t,n)):(l(" PPA: Anonymous user - customizing paywall"),(o=(n=t).querySelector("h2, h3, h4"))&&(o.textContent="This post is for subscribers only"),(o=n.querySelector("p"))&&(o.textContent="Sign up for a free account to buy individual articles or subscribe for unlimited access."),(o=n.querySelector('a[data-portal="signup"]'))&&!o.textContent.toLowerCase().includes("free")&&(o.textContent="Sign up free"),l(" PPA: Anonymous paywall customized")):l(" PPA: No article metadata found"):l(" PPA: No paywall found (public post or paid member)"))}function p(e,t){l(" PPA: Replacing Ghost paywall with buy option"),e.innerHTML=`
      <div class="gh-post-upgrade-cta-content">
        <h2>This post is for paid subscribers only</h2>
        <p>Buy this article for $5 or upgrade to a paid subscription for unlimited access.</p>
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;">
          <a href="#" 
             class="gh-btn gh-btn-primary ppa-buy-btn"
             data-post-id="${t.dataset.postId}"
             data-post-title="${t.dataset.postTitle}"
             data-post-url="${t.dataset.postUrl}"
             data-member-email="${t.dataset.memberEmail}"
             ${t.dataset.memberName?`data-member-name="${t.dataset.memberName}"`:""}>
            Buy this article for $5
          </a>
          <a href="#/portal/signup" 
             class="gh-btn"
             data-portal="signup">
            Upgrade to subscription
          </a>
        </div>
      </div>
    `;t=e.querySelector(".ppa-buy-btn");t&&t.addEventListener("click",n)}async function n(t){t.preventDefault();t=t.currentTarget;l(" PPA: Buy button clicked"),t.disabled=!0,t.textContent="Loading...";try{var e=await fetch(u+"/create-tip-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:t.dataset.postId,postTitle:t.dataset.postTitle,postUrl:t.dataset.postUrl,memberEmail:t.dataset.memberEmail,memberName:t.dataset.memberName||""})}),n=await e.json();if(l(" PPA: API response:",e.status,n),!e.ok)throw new Error(n.error||n.message||"API request failed");if(!n.checkoutUrl)throw new Error("No checkout URL received");l(" PPA: Redirecting to Stripe checkout"),window.location.href=n.checkoutUrl}catch(e){d(" PPA: Checkout creation failed:",e),alert("Failed to create checkout. Please try again."),t.disabled=!1,t.textContent="Buy this article for $5"}}l(" PPA: Script loaded"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){setTimeout(e,100)}):setTimeout(e,100)})();class QualityCoachClient{constructor(e={}){this.apiBase=e.apiBase||"http://localhost:8000",this.storageKey=e.storageKey||"qc_thread_id",this.accessToken=null,this.threadId=null,this.storage=e.storage||("undefined"!=typeof localStorage?localStorage:null)}init(){return this.storage&&(this.threadId=this.storage.getItem(this.storageKey)),this.threadId||(this.threadId=this.generateClientThreadId(),this.storage&&this.storage.setItem(this.storageKey,this.threadId)),this.threadId}generateClientThreadId(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}setAccessToken(e){this.accessToken=e}async fetchWithRetry(n,o,s=3,i=1e3){try{var a=await fetch(n,o);if(429===a.status){var e=a.headers.get("Retry-After");let t=e?1e3*parseInt(e):i;if(0<s)return await new Promise(e=>setTimeout(e,t)),this.fetchWithRetry(n,o,s-1,2*i)}if(500<=a.status&&0<s)return await new Promise(e=>setTimeout(e,i)),this.fetchWithRetry(n,o,s-1,2*i);if(a.ok)return a;{let e="Request failed: "+a.status;try{var t=await a.json();t.detail?e=t.detail:t.message&&(e=t.message)}catch(e){}var r=new Error(e);throw r.status=a.status,r}}catch(e){if(0<s&&("TypeError"===e.name||"AbortError"===e.name))return await new Promise(e=>setTimeout(e,i)),this.fetchWithRetry(n,o,s-1,2*i);throw e}}async checkAccess(e){if(e)return(await this.fetchWithRetry(this.apiBase+"/api/v1/access/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})})).json();throw new Error("Email is required")}async sendMessage(e,t=[],n={}){if(this.accessToken)return this.threadId||this.init(),n.is_feedback?this.sendFeedback(e,n.rating,n):((e=await(await this.fetchWithRetry(this.apiBase+"/api/v1/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.accessToken},body:JSON.stringify({message:e,thread_id:this.threadId,history:t,context:n})})).json()).thread_id&&e.thread_id!==this.threadId&&(this.threadId=e.thread_id,this.storage)&&this.storage.setItem(this.storageKey,this.threadId),e);throw new Error("Access token required")}async sendFeedback(e,t,n={}){await this.fetchWithRetry(this.apiBase+"/api/v1/feedback",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.accessToken},body:JSON.stringify({thread_id:this.threadId,rating:t||"comment",comment:e,message_id:n.message_id})});return{answer:"Thanks for your feedback! I've shared it with Anne-Marie.",sources:[],thread_id:this.threadId}}async getHistory(){if(!this.accessToken)throw new Error("Access token required");if(!this.threadId)return[];try{return await(await this.fetchWithRetry(`${this.apiBase}/api/v1/conversations/${this.threadId}/messages`,{headers:{Authorization:"Bearer "+this.accessToken}})).json()}catch(e){if(404===e.status)return[];throw e}}}"undefined"!=typeof module&&module.exports&&(module.exports=QualityCoachClient),void 0!==window&&(window.QualityCoach=window.QualityCoach||{},window.QualityCoach.Client=QualityCoachClient);class QualityCoachUI{constructor(e){this.config=Object.assign({apiBase:"http://localhost:8000",memberEmail:"",isPaidMember:!1,postSlug:"",postTitle:""},e),this.DEFAULT_PLACEHOLDER="Ask a question...",this.FEEDBACK_PREFIX="feedback:",this.ACCESS_CACHE_PREFIX="qc_access_cache:",this.ACCESS_CACHE_MIN_VALID_MS=3e4,this.ACCESS_REFRESH_BUFFER_MS=3e5,this.ACCESS_LAG_MESSAGE_MS=500,this.PORTAL_SELECTORS=[".gh-portal-triggerbtn",".gh-portal-triggerbtn-root","#ghost-portal-root",'iframe[src*="ghost" i][title*="portal" i]'],this.PORTAL_OFFSET_CLASS="qc-offset-for-portal",this.PORTAL_CHECK_INTERVAL_MS=2e3,this.PORTAL_FALLBACK_TIMEOUT_MS=5e3,this.QC_STATE=Object.freeze({INIT:0,READY:1,OPEN:2,LOCKED:3}),this.personaNames={QUALITY_COACH:"Quality Coach",ENGINEERING_MANAGER:"Engineering Manager",DELIVERY_LEAD:"Delivery Lead",CEO_EXECUTIVE:"CEO/Executive",SOFTWARE_ENGINEER:"Software Engineer",TEST_LEAD:"Test Lead",OTHER:"Other"},this.personaFocus={QUALITY_COACH:["Facilitating workshops","Coaching techniques","Role definition"],ENGINEERING_MANAGER:["Team leadership","Quality strategy","Cross-team consistency"],DELIVERY_LEAD:["Delivery processes","Sprint planning","Release quality"],CEO_EXECUTIVE:["Strategic alignment","ROI and business value","Organizational quality"],SOFTWARE_ENGINEER:["Developer experience","Technical practices","Reducing technical debt"],TEST_LEAD:["Testing techniques","Test strategy","Transition to coaching"],OTHER:["General coaching guidance"]},this.accessToken=null,this.hasAccess=!1,this.isOpen=!1,this.isLocked=!1,this.conversationHistory=[],this.qcState=this.QC_STATE.INIT,this.portalObserver=null,this.portalInterval=null,this.portalFallbackTimer=null,this.lastAssistantMessage=null,this.accessRefreshTimer=null,this.accessLagTimer=null,this.currentPersona=null,this.currentPersonaConfidence=0,this.detectedPersonaMessage="",this.hasShownPersonaConfirmation=!1,this.messageCount=0,this.hasShownPersonaReminder=!1,this.elements={},this.QC_TEST_SKIP_ACCESS=(()=>{try{return!0===window.__QC_TEST_SKIP_ACCESS?!0:"1"===new URLSearchParams(window.location.search).get("qc_test_skip_access")}catch(e){return!1}})(),this.init()}init(){var e;this.elements={accessMessage:document.getElementById("qc-access-message"),widgetContainer:document.getElementById("quality-coach-widget"),chatButton:document.getElementById("qc-chat-button"),chatWindow:document.getElementById("qc-chat-window"),closeButton:document.getElementById("qc-close-button"),messages:document.getElementById("qc-messages"),input:document.getElementById("qc-input"),sendButton:document.getElementById("qc-send"),typingIndicator:document.getElementById("qc-typing"),personaBadge:document.getElementById("qc-persona-badge"),personaButton:document.getElementById("qc-persona-button"),personaLabel:document.getElementById("qc-persona-label"),personaDropdown:document.getElementById("qc-persona-dropdown")},this.elements.chatButton&&this.elements.chatWindow&&this.elements.closeButton&&("undefined"!=typeof window&&(window.QUALITY_COACH_SESSION={status:"pending",email:this.config.memberEmail}),(e=window.QualityCoach&&window.QualityCoach.Client||window.QualityCoachClient)?(this.client=new e({apiBase:this.config.apiBase,storageKey:"qc_thread_id"}),this.clientThreadId=this.client.init(),this.elements.chatButton.classList.add("is-loading"),this.elements.input&&(this.elements.input.placeholder=this.DEFAULT_PLACEHOLDER),this.config.memberEmail?this.initializeAccess():(this.setButtonAccessibility({loading:!1}),this.setState(this.QC_STATE.READY),this.elements.widgetContainer&&this.elements.widgetContainer.classList.remove("qc-widget--initializing")),this.monitorPortalTrigger(),this.restorePersonaBadge(),this.setupEventListeners(),this.checkReturnToChat()):console.error("QualityCoach.Client not loaded"))}checkReturnToChat(){try{"true"===localStorage.getItem("qc_return_to_chat")&&this.config.memberEmail&&setTimeout(()=>{this.openChatWindow(),localStorage.removeItem("qc_return_to_chat")},500)}catch(e){}}setupEventListeners(){var e;this.elements.chatButton.addEventListener("click",()=>{var e;"true"===this.elements.chatButton.getAttribute("aria-disabled")?(e=this.isLocked?"The Researcher is available to approved members. Reach out to join the beta.":"Still checking access",this.showStatus(e,this.isLocked?"warning":"info")):this.isOpen?this.closeChatWindow():this.openChatWindow()}),this.elements.closeButton.addEventListener("click",()=>this.closeChatWindow()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.closeChatWindow()}),this.elements.input&&(this.elements.input.addEventListener("input",()=>{this.elements.input.style.height="auto",this.elements.input.style.height=Math.min(this.elements.input.scrollHeight,120)+"px"}),this.elements.input.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())})),this.elements.sendButton&&this.elements.sendButton.addEventListener("click",()=>this.sendMessage()),this.elements.personaButton&&this.elements.personaDropdown&&(this.elements.personaButton.addEventListener("click",e=>{e.stopPropagation();e="block"===this.elements.personaDropdown.style.display;this.elements.personaDropdown.style.display=e?"none":"block",this.elements.personaButton.setAttribute("aria-expanded",!e)}),(e=document.getElementById("qc-persona-close"))&&e.addEventListener("click",e=>{e.stopPropagation(),this.elements.personaDropdown.style.display="none",this.elements.personaButton.setAttribute("aria-expanded","false")}),document.addEventListener("click",e=>{this.elements.personaButton.contains(e.target)||this.elements.personaDropdown.contains(e.target)||(this.elements.personaDropdown.style.display="none",this.elements.personaButton.setAttribute("aria-expanded","false"))}),document.addEventListener("click",t=>{var n=t.target.closest&&t.target.closest(".qc-persona-option");if(n&&this.elements.personaDropdown.contains(n)){let e=n.dataset.persona;try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}try{this.correctPersona(e,"user_selected")}catch(t){console.error("Error calling correctPersona from delegated handler",t)}this.elements.personaDropdown.style.display="none",this.elements.personaButton.setAttribute("aria-expanded","false"),setTimeout(()=>{try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}},150)}}),document.addEventListener("click",e=>{e=e.target.closest&&e.target.closest(".qc-persona-select-option");if(e){var t=document.getElementById("qc-persona-prompt");if(t&&t.contains(e)){e=e.dataset.persona;try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}this.currentPersona=e,this.updatePersonaDropdown(e,!0),t.style.display="none";t=document.getElementById("qc-example-questions-container");t&&(t.style.display="block"),"undefined"!=typeof gtag&&gtag("event","persona_selected_upfront",{persona:e})}}})),document.addEventListener("click",e=>{var e=e.target.closest&&e.target.closest(".qc-example-question");e&&(e=e.dataset.question)&&this.elements.input&&(this.elements.input.value=e,this.elements.input.focus(),this.sendMessage())}),document.querySelectorAll(".qc-signin-container a").forEach(e=>{e.addEventListener("click",()=>{try{localStorage.setItem("qc_return_to_chat","true")}catch(e){}})})}setState(t){if(this.qcState!==t){this.qcState=t;try{window.QUALITY_COACH_SESSION=window.QUALITY_COACH_SESSION||{},window.QUALITY_COACH_SESSION.status=Object.keys(this.QC_STATE).find(e=>this.QC_STATE[e]===t)||String(t)}catch(e){}switch(t){case this.QC_STATE.INIT:this.hasAccess=!1,this.isLocked=!1,this.isOpen=!1,this.setButtonAccessibility({disabled:!0,loading:!0,tooltip:"Checking access"});break;case this.QC_STATE.READY:this.hasAccess=!0,this.isLocked=!1,this.isOpen=!1,this.setButtonAccessibility({disabled:!1,loading:!1,tooltip:"Open Quality Coach Researcher"}),this.showStatus("");try{this.currentPersona&&(localStorage.setItem("qc_persona_choice",this.currentPersona),localStorage.setItem("qc_persona_confirmed","true"))}catch(e){}break;case this.QC_STATE.OPEN:this.hasAccess=!0,this.isLocked=!1,this.isOpen=!0,this.setButtonAccessibility({disabled:!1,loading:!1,tooltip:"Close Quality Coach Researcher"});try{this.currentPersona&&(localStorage.setItem("qc_persona_choice",this.currentPersona),localStorage.setItem("qc_persona_confirmed","true"))}catch(e){}break;case this.QC_STATE.LOCKED:this.hasAccess=!1,this.isLocked=!0,this.isOpen=!1,this.setButtonAccessibility({disabled:!0,loading:!1,tooltip:"Unable to verify beta access. Please refresh and try again."})}}}restorePersonaBadge(){var e=localStorage.getItem("qc_persona_choice");localStorage.getItem("qc_persona_confirmed")&&e&&this.elements.personaBadge&&this.elements.personaLabel&&(this.currentPersona=e,this.elements.personaLabel.textContent=this.personaNames[e]||e,this.elements.personaBadge.style.display="flex")}showStatus(e,t="info"){this.elements.accessMessage&&(e?(this.elements.accessMessage.textContent=e,this.elements.accessMessage.style.display="flex",this.elements.accessMessage.className="qc-access-message qc-"+t):(this.elements.accessMessage.textContent="",this.elements.accessMessage.style.display="none",this.elements.accessMessage.className="qc-access-message"))}startAccessLagTimer(){this.accessLagTimer&&clearTimeout(this.accessLagTimer),this.accessLagTimer=setTimeout(()=>{this.showStatus("Still checking access","info")},this.ACCESS_LAG_MESSAGE_MS)}stopAccessLagTimer(){this.accessLagTimer&&(clearTimeout(this.accessLagTimer),this.accessLagTimer=null)}attemptRestoreCachedAccess(){var e=this.loadAccessCache();return!!e&&(this.canUseCachedAccess(e)?(this.applyAccessSuccess({access_token:e.access_token,access_expires_at:e.access_expires_at,access_granted_via:e.access_granted_via,is_beta_tester:e.is_beta_tester,is_paid_member:e.is_paid_member},{source:"cache",skipCache:!0}),!0):(this.clearAccessCache(),!1))}applyAccessSuccess(e,{source:t="network",skipCache:n=!1}={}){e&&e.access_token&&(this.accessToken=e.access_token,this.client.setAccessToken(this.accessToken),this.elements.widgetContainer&&(this.elements.widgetContainer.classList.remove("qc-widget--hidden"),this.elements.widgetContainer.classList.remove("qc-widget--initializing")),window.QUALITY_COACH_SESSION=Object.assign(window.QUALITY_COACH_SESSION||{},{token:this.accessToken,expires_at:e.access_expires_at,granted_via:e.access_granted_via,email:this.config.memberEmail,source:t,is_beta_tester:e.is_beta_tester,is_paid_member:e.is_paid_member}),this.setState(this.QC_STATE.READY),n||this.saveAccessCache({access_token:e.access_token,access_expires_at:e.access_expires_at,access_granted_via:e.access_granted_via,is_beta_tester:e.is_beta_tester,is_paid_member:e.is_paid_member}),this.scheduleAccessRefresh(e.access_expires_at),this.showStatus(""),this.loadConversationHistory())}scheduleAccessRefresh(e){this.accessRefreshTimer&&(clearTimeout(this.accessRefreshTimer),this.accessRefreshTimer=null),e&&(e=Date.parse(e))&&(e=e-Date.now()-this.ACCESS_REFRESH_BUFFER_MS,this.accessRefreshTimer=e<=0?setTimeout(()=>{this.refreshAccessToken("expired")},1e3):setTimeout(()=>{this.refreshAccessToken("scheduled")},e))}async refreshAccessToken(t="scheduled"){try{await this.performAccessCheck({silent:!0})}catch(e){"undefined"!=typeof console&&console.debug&&console.debug("Access refresh failed",t,e)}}getCacheKey(){return""+this.ACCESS_CACHE_PREFIX+(this.config.memberEmail||"anonymous")}loadAccessCache(){if("undefined"==typeof sessionStorage)return null;try{var e=sessionStorage.getItem(this.getCacheKey());return e?JSON.parse(e):null}catch(e){return this.clearAccessCache(),null}}saveAccessCache(e){if("undefined"!=typeof sessionStorage&&e){e={...e,cached_at:(new Date).toISOString(),member_email:this.config.memberEmail};try{sessionStorage.setItem(this.getCacheKey(),JSON.stringify(e))}catch(e){}}}clearAccessCache(){"undefined"!=typeof sessionStorage&&(sessionStorage.removeItem(this.getCacheKey()),this.accessRefreshTimer)&&(clearTimeout(this.accessRefreshTimer),this.accessRefreshTimer=null)}canUseCachedAccess(e){return!!(e&&e.access_token&&e.access_expires_at)&&!(!(e=Date.parse(e.access_expires_at))||e-Date.now()<=this.ACCESS_CACHE_MIN_VALID_MS)}monitorPortalTrigger(){"undefined"==typeof document||(this.updatePortalOffset(),"undefined"!=typeof MutationObserver&&(this.portalObserver&&this.portalObserver.disconnect(),this.portalObserver=new MutationObserver(()=>{this.updatePortalOffset()}),this.portalObserver.observe(document.body,{childList:!0,subtree:!0})),this.portalInterval||(this.portalInterval=setInterval(()=>{this.updatePortalOffset()},this.PORTAL_CHECK_INTERVAL_MS)),this.portalFallbackTimer)||(this.portalFallbackTimer=setTimeout(()=>{document.body&&!document.body.classList.contains(this.PORTAL_OFFSET_CLASS)&&document.body.classList.add(this.PORTAL_OFFSET_CLASS)},this.PORTAL_FALLBACK_TIMEOUT_MS))}updatePortalOffset(){var e;document.body&&(e=this.findPortalElement(),e=Boolean(e),document.body.classList.toggle(this.PORTAL_OFFSET_CLASS,e),e&&this.portalFallbackTimer&&(clearTimeout(this.portalFallbackTimer),this.portalFallbackTimer=null),e)&&this.portalInterval&&(clearInterval(this.portalInterval),this.portalInterval=null)}findPortalElement(){for(var e of this.PORTAL_SELECTORS)if(e){e=document.querySelector(e);if(e)return e}return null}async loadConversationHistory(){if(this.clientThreadId&&this.accessToken&&!(0<this.conversationHistory.length))try{var e,t=await this.client.getHistory();Array.isArray(t)&&0<t.length&&((e=document.querySelector(".qc-welcome-message"))&&(e.style.display="none"),t.forEach(e=>{this.addMessage(e.content,e.role,null,!1,!1,e.id),this.conversationHistory.push({role:e.role,content:e.content})}))}catch(e){console.debug("Failed to load conversation history",e)}}async initializeAccess(){var e=this.attemptRestoreCachedAccess();if(!e){if(this.QC_TEST_SKIP_ACCESS)try{var t={has_access:!0,access_token:"qc-test-token",access_expires_at:new Date(Date.now()+36e5).toISOString(),access_granted_via:"localtest",is_beta_tester:!0,is_paid_member:!0};return this.client.setAccessToken(t.access_token),void this.applyAccessSuccess(t,{source:"localtest",skipCache:!0})}catch(e){"undefined"!=typeof console&&console.warn&&console.warn("QC test access shortcut failed, falling back to network check",e)}await this.performAccessCheck()}}async performAccessCheck({silent:t=!1}={}){t||(this.showStatus("Checking access"),this.startAccessLagTimer());try{var e=await this.client.checkAccess(this.config.memberEmail);return(this.elements.widgetContainer&&this.elements.widgetContainer.classList.remove("qc-widget--initializing"),e.has_access&&e.access_token)?(this.client.setAccessToken(e.access_token),this.applyAccessSuccess(e,{source:t?"refresh":"network"}),!0):(this.setState(this.QC_STATE.LOCKED),this.hideChatWidget(),this.showStatus(e.reason||"The Researcher is available to beta testers only right now.","warning"),this.clearAccessCache(),!1)}catch(e){return this.setState(this.QC_STATE.LOCKED),this.elements.widgetContainer&&this.elements.widgetContainer.classList.remove("qc-widget--initializing"),t||this.showStatus("Unable to verify beta access. Please refresh and try again.","error"),this.clearAccessCache(),!1}finally{t||this.stopAccessLagTimer()}}setButtonAccessibility({disabled:e,loading:t,tooltip:n}){this.elements.chatButton&&(this.elements.chatButton.classList.toggle("is-loading",Boolean(t)),void 0!==e&&(e?(this.elements.chatButton.setAttribute("aria-disabled","true"),this.elements.chatButton.disabled=!0):(this.elements.chatButton.removeAttribute("aria-disabled"),this.elements.chatButton.disabled=!1)),n?this.elements.chatButton.setAttribute("title",n):this.elements.chatButton.removeAttribute("title"))}hideChatWidget(){this.elements.widgetContainer&&this.elements.widgetContainer.classList.add("qc-widget--hidden"),this.setButtonAccessibility({disabled:!0,loading:!1})}openChatWindow(){this.qcState!==this.QC_STATE.READY&&this.qcState!==this.QC_STATE.OPEN?this.showStatus("The Researcher is available to approved members. Reach out to join the beta.","warning"):(this.setState(this.QC_STATE.OPEN),this.elements.chatWindow.classList.add("is-visible"),this.elements.chatButton.classList.add("is-open"),this.elements.chatButton.setAttribute("aria-expanded","true"),this.elements.chatButton.setAttribute("aria-label","Close Quality Coach Researcher"),this.elements.input.focus(),"undefined"!=typeof gtag&&gtag("event","qc_chat_opened",{post_slug:this.config.postSlug,post_title:this.config.postTitle}))}showPersonaPromptIfNeeded(){var e=localStorage.getItem("qc_persona_confirmed");let t=document.getElementById("qc-persona-prompt"),n=document.getElementById("qc-example-questions-container");!e&&t&&n?(t.style.display="block",n.style.display="none",(e=document.getElementById("qc-persona-skip"))&&!e.dataset.handlerAttached&&(e.dataset.handlerAttached="true",e.addEventListener("click",()=>{t.style.display="none",n.style.display="block"}))):n&&(n.style.display="block",t)&&(t.style.display="none")}closeChatWindow(){this.setState(this.QC_STATE.READY),this.elements.chatWindow.classList.remove("is-visible"),this.elements.chatButton.classList.remove("is-open"),this.elements.chatButton.setAttribute("aria-expanded","false"),this.elements.chatButton.setAttribute("aria-label","Open Quality Coach Researcher"),this.elements.chatButton.focus()}sendMessage(t={}){if(this.hasAccess&&this.accessToken){var{messageOverride:t=null,isFeedbackOverride:s=null,skipUserMessage:i=!1,feedbackRating:a=null,messageId:r=null}=t;let e=null===t;t=((e?this.elements.input?this.elements.input.value:"":t)||"").trim();if(t){var c=e&&t.toLowerCase().startsWith(this.FEEDBACK_PREFIX);let n=c?t.slice(this.FEEDBACK_PREFIX.length).trimStart():t,o="boolean"==typeof s?s:c;if(!o||n)return o&&this.showStatus("Thanks for the feedback  it goes straight to Anne-Marie.","info"),s=o?n:t,o||i||this.addMessage(s,"user",null,null,o),e&&this.elements.input&&(this.elements.input.value="",this.elements.input.style.height="auto"),e&&(this.elements.input&&(this.elements.input.disabled=!0),this.elements.sendButton)&&(this.elements.sendButton.disabled=!0),this.elements.typingIndicator.style.display="flex",this.client.sendMessage(n,this.conversationHistory,{post_slug:this.config.postSlug,post_title:this.config.postTitle,member_email:this.config.memberEmail,is_feedback:o,rating:a,persona:this.currentPersona,message_id:r}).then(e=>{var t;this.elements.typingIndicator.style.display="none",e.answer?(o||(e.persona&&(this.currentPersona=e.persona,this.currentPersonaConfidence=e.persona_confidence,this.detectedPersonaMessage=n,t=!this.hasShownPersonaConfirmation&&!localStorage.getItem("qc_persona_confirmed"),this.updatePersonaDropdown(e.persona,!t)),this.addMessage(e.answer,"assistant",e.sources,!1,e.low_relevance,e.message_id),this.conversationHistory.push({role:"user",content:n}),this.conversationHistory.push({role:"assistant",content:e.answer}),this.messageCount++,1!==this.messageCount||localStorage.getItem("qc_persona_confirmed")||this.showSoftPersonaPrompt(),3===this.messageCount&&!this.hasShownPersonaReminder&&this.currentPersona&&this.showPersonaReminder()),o&&"undefined"!=typeof gtag&&gtag("event","quality_coach_feedback_submitted",{post_slug:this.config.postSlug,post_title:this.config.postTitle})):this.addMessage("Sorry, I encountered an error. Please try again.","error",null,null)}).catch(e=>{this.elements.typingIndicator.style.display="none",e.message.includes("401")||e.message.includes("403")?(this.hasAccess=!1,this.isLocked=!0,this.showStatus("Your access expired. Refresh the page to continue.","warning"),this.setButtonAccessibility({disabled:!0,loading:!1,tooltip:"Access expired - refresh to continue."})):this.addMessage("Sorry, I'm having trouble connecting. Please try again later.","error")}).finally(()=>{e&&(this.elements.input&&(this.elements.input.disabled=!1,this.elements.input.focus()),this.elements.sendButton)&&(this.elements.sendButton.disabled=!1)});this.showStatus("Share a short note before sending feedback.","warning")}}else this.showStatus("Your access token expired. Refresh the page to continue.","warning")}formatMessage(e){return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/^- (.*?)$/gm," $1").replace(/\n/g,"<br>")}updatePersonaDropdown(t,e=!0){if(t){document.querySelectorAll(".qc-persona-option").forEach(e=>{e.dataset.persona===t?e.classList.add("is-active"):e.classList.remove("is-active")}),this.elements.personaLabel&&(this.elements.personaLabel.textContent=this.personaNames[t]||t),this.elements.personaBadge&&e&&(this.elements.personaBadge.style.display="flex");try{localStorage.setItem("qc_persona_choice",t),e&&localStorage.setItem("qc_persona_confirmed","true")}catch(e){}}}showSoftPersonaPrompt(){let n=document.createElement("div");n.className="qc-soft-persona-prompt",n.innerHTML=`
            <div class="qc-soft-persona-content">
                <div class="qc-soft-persona-header">
                    <span class="qc-soft-persona-icon"></span>
                    <strong>I can tailor advice to your role</strong>
                </div>
                <div class="qc-soft-persona-options">
                    <button class="qc-soft-persona-btn" data-persona="ENGINEERING_MANAGER">
                        <span class="qc-persona-icon"></span>
                        <span>Manager</span>
                    </button>
                    <button class="qc-soft-persona-btn" data-persona="SOFTWARE_ENGINEER">
                        <span class="qc-persona-icon"></span>
                        <span>Engineer</span>
                    </button>
                    <button class="qc-soft-persona-btn" data-persona="QUALITY_COACH">
                        <span class="qc-persona-icon"></span>
                        <span>Coach</span>
                    </button>
                    <button class="qc-soft-persona-btn" data-persona="TEST_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Test Lead</span>
                    </button>
                    <button class="qc-soft-persona-btn" data-persona="DELIVERY_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Delivery Lead</span>
                    </button>
                    <button class="qc-soft-persona-btn qc-soft-persona-more" data-action="show-more">
                        <span>More </span>
                    </button>
                </div>
                <button class="qc-soft-persona-skip">Skip for now</button>
            </div>
        `,n.querySelectorAll(".qc-soft-persona-btn[data-persona]").forEach(t=>{t.addEventListener("click",()=>{var e=t.dataset.persona;try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}this.currentPersona=e,this.updatePersonaDropdown(e,!0),n.classList.add("qc-fade-out"),setTimeout(()=>n.remove(),300),"undefined"!=typeof gtag&&gtag("event","persona_selected_after_first_answer",{persona:e})})});var e=n.querySelector('[data-action="show-more"]'),e=(e&&e.addEventListener("click",()=>{this.showFullPersonaSelector(n)}),n.querySelector(".qc-soft-persona-skip"));e&&e.addEventListener("click",()=>{n.classList.add("qc-fade-out"),setTimeout(()=>n.remove(),300)}),this.elements.messages.appendChild(n),setTimeout(()=>{n.style.animation="qc-gentle-bounce 1s ease-in-out"},2e3)}showFullPersonaSelector(n){n.innerHTML=`
            <div class="qc-soft-persona-content">
                <div class="qc-soft-persona-header">
                    <strong>What's your role?</strong>
                </div>
                <div class="qc-persona-selector qc-persona-selector-inline">
                    <button class="qc-persona-select-option" data-persona="QUALITY_COACH">
                        <span class="qc-persona-icon"></span>
                        <span>Quality Coach</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="ENGINEERING_MANAGER">
                        <span class="qc-persona-icon"></span>
                        <span>Engineering Manager</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="DELIVERY_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Delivery Lead</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="CEO_EXECUTIVE">
                        <span class="qc-persona-icon"></span>
                        <span>CEO/Executive</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="SOFTWARE_ENGINEER">
                        <span class="qc-persona-icon"></span>
                        <span>Software Engineer</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="TEST_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Test Lead</span>
                    </button>
                </div>
                <button class="qc-soft-persona-skip">Skip for now</button>
            </div>
        `,n.querySelectorAll(".qc-persona-select-option").forEach(t=>{t.addEventListener("click",()=>{var e=t.dataset.persona;try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}this.currentPersona=e,this.updatePersonaDropdown(e,!0),n.classList.add("qc-fade-out"),setTimeout(()=>n.remove(),300),"undefined"!=typeof gtag&&gtag("event","persona_selected_from_full_selector",{persona:e})})});var e=n.querySelector(".qc-soft-persona-skip");e&&e.addEventListener("click",()=>{n.classList.add("qc-fade-out"),setTimeout(()=>n.remove(),300)})}showPersonaReminder(){if(!this.hasShownPersonaReminder){this.hasShownPersonaReminder=!0;var t=this.personaNames[this.currentPersona]||this.currentPersona;let e=document.createElement("div");e.className="qc-persona-reminder",e.innerHTML=`
            <div class="qc-persona-reminder-content">
                <span class="qc-persona-reminder-icon"></span>
                <div class="qc-persona-reminder-text">
                    <strong>Tip:</strong> I'm tailoring advice for ${t}s.
                    Not quite right? Click the badge in the header to change it.
                </div>
                <button class="qc-persona-reminder-dismiss" aria-label="Dismiss"></button>
            </div>
        `,e.querySelector(".qc-persona-reminder-dismiss").addEventListener("click",()=>{e.classList.add("qc-fade-out"),setTimeout(()=>e.remove(),300)}),setTimeout(()=>{e.parentNode&&(e.classList.add("qc-fade-out"),setTimeout(()=>e.remove(),300))},8e3),this.elements.messages.appendChild(e),this.elements.messages.scrollTop=this.elements.messages.scrollHeight}}showPersonaConfirmation(t){var n=localStorage.getItem("qc_persona_confirmed");if(!this.hasShownPersonaConfirmation&&!n){this.hasShownPersonaConfirmation=!0;var n=this.personaNames[t]||t,o=(this.personaFocus[t]||this.personaFocus.OTHER).map(e=>" "+e).join("\n");let e=document.createElement("div");e.className="qc-persona-confirmation",e.setAttribute("tabindex","-1"),e.innerHTML=`
            <div class="qc-persona-confirmation-content">
                <div class="qc-persona-confirmation-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div class="qc-persona-confirmation-text">
                    <strong>I'm responding as if you're a ${n}, so I'll focus on:</strong>
                    <div class="qc-persona-focus-list">${o}</div>
                    <span class="qc-persona-confirm-question">Is that right?</span>
                </div>
                <div class="qc-persona-confirmation-actions">
                    <button class="qc-persona-confirm-yes" data-action="confirm">Yes, that's right</button>
                    <button class="qc-persona-confirm-change" data-action="change">Actually, I'm a...</button>
                </div>
            </div>
        `,this.elements.messages.appendChild(e),e.querySelector('[data-action="confirm"]').addEventListener("click",()=>{this.confirmPersona(t),e.classList.add("qc-fade-out"),setTimeout(()=>e.remove(),300)}),e.querySelector('[data-action="change"]').addEventListener("click",()=>{this.showPersonaSelector(e)})}}showPersonaSelector(n){n.innerHTML=`
            <div class="qc-persona-confirmation-content">
                <div class="qc-persona-confirmation-text">
                    <strong>What's your role?</strong>
                </div>
                <div class="qc-persona-selector">
                    <button class="qc-persona-select-option" data-persona="QUALITY_COACH">
                        <span class="qc-persona-icon"></span>
                        <span>Quality Coach</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="ENGINEERING_MANAGER">
                        <span class="qc-persona-icon"></span>
                        <span>Engineering Manager</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="DELIVERY_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Delivery Lead</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="CEO_EXECUTIVE">
                        <span class="qc-persona-icon"></span>
                        <span>CEO/Executive</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="SOFTWARE_ENGINEER">
                        <span class="qc-persona-icon"></span>
                        <span>Software Engineer</span>
                    </button>
                    <button class="qc-persona-select-option" data-persona="TEST_LEAD">
                        <span class="qc-persona-icon"></span>
                        <span>Test Lead</span>
                    </button>
                </div>
            </div>
        `,n.querySelectorAll(".qc-persona-select-option").forEach(t=>{t.addEventListener("click",()=>{var e=t.dataset.persona;try{localStorage.setItem("qc_persona_choice",e),localStorage.setItem("qc_persona_confirmed","true")}catch(e){}this.correctPersona(e,"user_selected"),n.classList.add("qc-fade-out"),setTimeout(()=>n.remove(),300)})})}confirmPersona(e){localStorage.setItem("qc_persona_confirmed","true"),localStorage.setItem("qc_persona_choice",e),this.elements.personaBadge&&(this.elements.personaBadge.style.display="flex",this.elements.personaLabel)&&(this.elements.personaLabel.textContent=this.personaNames[e]||e)}async correctPersona(n,o="user_selected"){if(n&&n!==this.currentPersona){let t=this.currentPersona,e=(this.currentPersona=n,0<this.conversationHistory.length?this.conversationHistory[this.conversationHistory.length-2]?.content:null);this.updatePersonaDropdown(n);try{localStorage.setItem("qc_persona_confirmed","true"),localStorage.setItem("qc_persona_choice",n)}catch(e){}if(this.elements.personaBadge&&(this.elements.personaBadge.style.display="flex",this.elements.personaLabel)&&(this.elements.personaLabel.textContent=this.personaNames[n]||n),this.accessToken){var s,i=async()=>{try{return await fetch(this.config.apiBase+"/api/v1/persona/correct",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.accessToken},body:JSON.stringify({thread_id:this.clientThreadId,user_id:this.config.memberEmail,corrected_persona:n,original_persona:t,original_confidence:this.currentPersonaConfidence,message_context:e,correction_reason:o})})}catch(e){throw e}};try{let e=await i();if(401===e.status){try{await this.refreshAccessToken("correct-persona-retry")}catch(e){console.warn("correctPersona: refreshAccessToken failed",e)}e=await i()}e.ok?"success"===(s=await e.json()).status?(this.showStatus(`Persona updated to ${this.personaNames[n]}. Your next responses will be tailored accordingly.`,"info"),setTimeout(()=>this.showStatus("",""),3e3),"undefined"!=typeof gtag&&gtag("event","persona_corrected",{from:t,to:n,reason:o})):console.warn("correctPersona: server returned non-success",s):console.warn("correctPersona: server responded with",e.status)}catch(e){console.error("Failed to update persona (network/error):",e)}}else try{console.warn("correctPersona: no access token, skipping remote correction")}catch(e){}}}addMessage(o,e,s,n=!1,i=!1,a=null){let r=document.createElement("div");r.className="qc-message qc-message-"+e,a&&(r.dataset.messageId=a);a=document.createElement("div");if(a.className="qc-message-bubble","user"===e?a.textContent=o:a.innerHTML=this.formatMessage(o),n&&(r.classList.add("qc-message-feedback"),(n=document.createElement("div")).className="qc-feedback-message-label",n.textContent="Feedback sent to Anne-Marie",r.appendChild(n)),r.appendChild(a),"assistant"===e){n=document.createElement("div"),a=(n.className="qc-sources-container",s&&s.filter(e=>.5<=e.similarity)),s=["handbook doesn't","handbook does not","handbook doesn't directly","handbook does not directly","doesn't define","does not define","doesn't cover","does not cover","not covered in the handbook","not in the handbook"];let t=o.toLowerCase();var s=s.some(e=>t.includes(e)),i=!i&&!s&&a&&0<a.length,s=s&&a&&0<a.length;i?(i=[...new Set(a.map(e=>e.section||e.label||e.chapter||"Handbook"))].slice(0,3),n.innerHTML=`
                    <div class="qc-sources-badge qc-sources-handbook">
                        <span class="qc-sources-icon"></span>
                        <span class="qc-sources-label">From the Handbook:</span>
                        <span class="qc-sources-chapters">${i.join(", ")}</span>
                    </div>
                `):s?(i=[...new Set(a.map(e=>e.section||e.label||e.chapter||"Handbook"))].slice(0,2),n.innerHTML=`
                    <div class="qc-sources-badge qc-sources-general">
                        <span class="qc-sources-icon"></span>
                        <span class="qc-sources-label">General coaching guidance</span>
                    </div>
                    <div class="qc-sources-badge qc-sources-related">
                        <span class="qc-sources-icon"></span>
                        <span class="qc-sources-label">Related content from the Handbook:</span>
                        <span class="qc-sources-chapters">${i.join(", ")}</span>
                    </div>
                `):n.innerHTML=`
                    <div class="qc-sources-badge qc-sources-general">
                        <span class="qc-sources-icon"></span>
                        <span class="qc-sources-label">General coaching guidance</span>
                    </div>
                `,r.appendChild(n)}if("assistant"===e){this.lastAssistantMessage=r;s=document.createElement("div");s.className="qc-message-actions";let e=document.createElement("button"),t=(e.className="qc-action-btn",e.title="Copy to clipboard",e.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',e.onclick=()=>{navigator.clipboard.writeText(o),e.classList.add("is-active"),setTimeout(()=>e.classList.remove("is-active"),1e3)},document.createElement("button")),n=(t.className="qc-action-btn",t.title="Helpful",t.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>',t.onclick=()=>this.handleFeedback(r,"positive",t),document.createElement("button"));n.className="qc-action-btn",n.title="Not helpful",n.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path></svg>',n.onclick=()=>this.handleFeedback(r,"negative",n),s.appendChild(e),s.appendChild(t),s.appendChild(n),r.appendChild(s)}this.elements.messages.appendChild(r),"assistant"===e?r.scrollIntoView({behavior:"smooth",block:"start"}):this.elements.messages.scrollTop=this.elements.messages.scrollHeight}handleFeedback(n,o,e){var t=n.querySelector(".qc-inline-feedback");t&&t.remove(),n.querySelectorAll(".qc-action-btn").forEach(e=>e.classList.remove("is-active")),e.classList.add("is-active");let s=document.createElement("div"),i=(s.className="qc-inline-feedback",document.createElement("textarea"));i.placeholder="positive"===o?"What was helpful? (Optional)":"How can we improve this? (Optional)";var t=document.createElement("div"),a=(t.className="qc-inline-actions",document.createElement("button"));a.className="qc-btn-xs qc-btn-ghost",a.textContent="Cancel",a.onclick=()=>{s.remove(),e.classList.remove("is-active")};let r=document.createElement("button");r.className="qc-btn-xs qc-btn-primary",r.textContent="Send Feedback",r.onclick=()=>{var e=i.value.trim(),t=(r.disabled=!0,r.textContent="Sending...",n.dataset.messageId);this.submitFeedback(o,e,t).then(()=>{s.innerHTML='<div style="color: var(--qc-accent); font-size: 13px; font-weight: 500;">Thanks for your feedback!</div>',setTimeout(()=>{s.remove()},2e3)}).catch(()=>{r.disabled=!1,r.textContent="Send Feedback"})},t.appendChild(a),t.appendChild(r),s.appendChild(i),s.appendChild(t),n.appendChild(s),i.focus()}submitFeedback(e,t,n){return this.sendMessage({messageOverride:t||e,isFeedbackOverride:!0,feedbackRating:e,messageId:n})}}void 0!==window&&(window.QualityCoach=window.QualityCoach||{},window.QualityCoach.UI=QualityCoachUI),pagination(!0),(()=>{if(document.body.classList.contains("post-template")){let t=document.querySelector(".gh-cover");if(t){let e=t.querySelector(".gh-cover-image");window.addEventListener("load",function(){t.style.setProperty("--cover-height",e.clientWidth*e.naturalHeight/e.naturalWidth+"px"),t.classList.remove("loading")})}}})();